var MESSAGES = MESSAGES || {};
(function (c) {
  "use strict";
  var o = felan_my_wallet_vars.ajax_url,
    s = felan_my_wallet_vars.not_wallet,
    d = c(".felan-project-withdraw"),
    i = c("#form-project-withdraw");
  MESSAGES = {
    init: function () {
      this.submit_withdraw();
      this.my_wallet();
    },
    submit_withdraw: function () {
      c("body").on("click", "#btn-submit-withdraw", function (t) {
        t.preventDefault();
        var a = c(this),
          n = i.find('select[name="withdraw_payment"]').val(),
          e = i.find('input[name="withdraw_price"]').val();
        c.ajax({
          type: "POST",
          url: o,
          dataType: "json",
          data: {
            action: "felan_project_submit_withdraw",
            withdraw_payment: n,
            withdraw_price: e,
          },
          beforeSend: function () {
            a.find(".btn-loader").html(
              '<i class="fal fa-spinner fa-spin"></i>'
            );
          },
          success: function (t) {
            if (t.success == true) {
              location.reload();
              i.find(".felan-message-error").addClass("true");
            }
            i.find(".felan-message-error").text(t.message);
            a.find(".btn-loader").html(
              '<i class="fas fa-arrow-to-bottom"></i>'
            );
          },
        });
      });
    },
    my_wallet: function () {
      d.find(".select-pagination")
        .change(function () {
          var t = "";
          c(".select-pagination option:selected").each(function () {
            t += c(this).val() + " ";
          });
          c(this).attr("value");
        })
        .trigger("change");
      d.find("select.search-control").on("change", function () {
        c(".felan-pagination").find('input[name="paged"]').val(1);
        e();
      });
      d.find("input.search-control").on("input", function () {
        c(".felan-pagination").find('input[name="paged"]').val(1);
        e();
      });
      function t(n, e) {
        var i = 0;
        return function () {
          var t = this,
            a = arguments;
          clearTimeout(i);
          i = setTimeout(function () {
            n.apply(t, a);
          }, e || 0);
        };
      }
      d.find("input.project-search-control").keyup(
        t(function () {
          c(".felan-pagination").find('input[name="paged"]').val(1);
          e();
        }, 1e3)
      );
      c("body").on("click", ".felan-pagination a.page-numbers", function (t) {
        t.preventDefault();
        c(".felan-pagination li .page-numbers").removeClass("current");
        c(this).addClass("current");
        var a = c(this).text();
        var n = 1;
        if (d.find(".felan-pagination").find('input[name="paged"]').val()) {
          n = c(".felan-pagination").find('input[name="paged"]').val();
        }
        if (c(this).hasClass("next")) {
          a = parseInt(n) + 1;
        }
        if (c(this).hasClass("prev")) {
          a = parseInt(n) - 1;
        }
        d.find(".felan-pagination").find('input[name="paged"]').val(a);
        e();
      });
      var a = 1;
      d.find(".select-pagination").attr("data-value", a);
      function e() {
        var l = 1;
        var t = d.find("#my-wallet").height();
        var a = d.find('select[name="wallet_status"]').val(),
          n = d.find('select[name="wallet_method"]').val(),
          e = d.find('select[name="item_amount"]').val(),
          i = d.find('select[name="wallet_sort_by"]').val();
        l = c(".felan-pagination").find('input[name="paged"]').val();
        c.ajax({
          dataType: "json",
          url: o,
          data: {
            action: "felan_freelancer_wallet_project",
            item_amount: e,
            paged: l,
            wallet_status: a,
            wallet_method: n,
            wallet_sort_by: i,
          },
          beforeSend: function () {
            d.find(".felan-loading-effect").addClass("loading").fadeIn();
            d.find("#my-wallet").height(t);
          },
          success: function (t) {
            if (t.success === true) {
              var a = d.find(".items-pagination"),
                n = a.find('select[name="item_amount"] option:selected').val(),
                e = t.total_post,
                i = n * l + 1 - n,
                o = n * l;
              if (e < i) {
                i = n * (l - 1) + 1;
              }
              if (e < o) {
                o = e;
              }
              c(".num-first").text(i);
              c(".num-last").text(o);
              if (e > n) {
                a.closest(".pagination-dashboard").show();
                a.find(".num-total").html(t.total_post);
              } else {
                a.closest(".pagination-dashboard").hide();
              }
              d.find(".pagination").html(t.pagination);
              d.find("#my-wallet tbody").fadeOut("fast", function () {
                d.find("#my-wallet tbody").html(t.wallet_html);
                d.find("#my-wallet tbody").fadeIn(300);
              });
              d.find("#my-wallet").css("height", "auto");
            } else {
              d.find("#my-wallet tbody").html(
                '<span class="not-project">' + s + "</span>"
              );
            }
            d.find(".felan-loading-effect").removeClass("loading").fadeOut();
          },
        });
      }
    },
  };
  c(document).ready(function () {
    MESSAGES.init();
  });
})(jQuery);
