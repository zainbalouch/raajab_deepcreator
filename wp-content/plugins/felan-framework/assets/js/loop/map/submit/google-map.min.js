jQuery(document).ready(function () {
  var e = felan_google_map_submit_vars.api_key,
    t = felan_google_map_submit_vars.lng,
    o = felan_google_map_submit_vars.lat,
    l = felan_google_map_submit_vars.map_style,
    a = felan_google_map_submit_vars.map_type,
    n = felan_google_map_submit_vars.form_submit;
  var r, i;
  var s = new google.maps.LatLngBounds();
  var m = [
    { elementType: "geometry", stylers: [{ color: "#f5f5f5" }] },
    { elementType: "labels.icon", stylers: [{ visibility: "off" }] },
    { elementType: "labels.text.fill", stylers: [{ color: "#616161" }] },
    { elementType: "labels.text.stroke", stylers: [{ color: "#f5f5f5" }] },
    {
      featureType: "administrative.land_parcel",
      elementType: "labels.text.fill",
      stylers: [{ color: "#bdbdbd" }],
    },
    {
      featureType: "poi",
      elementType: "geometry",
      stylers: [{ color: "#eeeeee" }],
    },
    {
      featureType: "poi",
      elementType: "labels.text.fill",
      stylers: [{ color: "#757575" }],
    },
    {
      featureType: "poi.park",
      elementType: "geometry",
      stylers: [{ color: "#e5e5e5" }],
    },
    {
      featureType: "poi.park",
      elementType: "labels.text.fill",
      stylers: [{ color: "#9e9e9e" }],
    },
    {
      featureType: "road",
      elementType: "geometry",
      stylers: [{ color: "#ffffff" }],
    },
    {
      featureType: "road.arterial",
      elementType: "labels.text.fill",
      stylers: [{ color: "#757575" }],
    },
    {
      featureType: "road.highway",
      elementType: "geometry",
      stylers: [{ color: "#dadada" }],
    },
    {
      featureType: "road.highway",
      elementType: "labels.text.fill",
      stylers: [{ color: "#616161" }],
    },
    {
      featureType: "road.local",
      elementType: "labels.text.fill",
      stylers: [{ color: "#9e9e9e" }],
    },
    {
      featureType: "transit.line",
      elementType: "geometry",
      stylers: [{ color: "#e5e5e5" }],
    },
    {
      featureType: "transit.station",
      elementType: "geometry",
      stylers: [{ color: "#eeeeee" }],
    },
    {
      featureType: "water",
      elementType: "geometry",
      stylers: [{ color: "#9dcaef" }],
    },
    {
      featureType: "water",
      elementType: "labels.text.fill",
      stylers: [{ color: "#9e9e9e" }],
    },
  ];
  r = m;
  if (l) {
    r = JSON.parse(l);
  }
  var o = parseFloat(o),
    t = parseFloat(t);
  var y;
  var p = Math.max(
    document.documentElement.clientWidth,
    window.innerWidth || 0
  );
  var c = p > 1024;
  var d = {
    zoom: 14,
    center: { lat: o, lng: t },
    mapTypeId: a,
    draggable: c,
    styles: r,
    mapTypeControl: false,
    streetViewControl: false,
    rotateControl: false,
    zoomControl: true,
    fullscreenControl: true,
  };
  var g = new google.maps.Map(document.getElementById("map"), d);
  y = new google.maps.Marker({
    map: g,
    draggable: true,
    position: { lat: o, lng: t },
  });
  var u = new google.maps.Geocoder();
  var f = new google.maps.InfoWindow({ maxWidth: 370 });
  h();
  v();
  function v() {
    g.addListener("click", function (e) {
      if (jQuery("body .lock-marker").length == 0) {
        y.setPosition(e.latLng);
        T(u, g, f, e.latLng);
        jQuery('input[name="felan_map_location"]').val(
          e.latLng.lat() + "," + e.latLng.lng()
        );
      }
    });
    google.maps.event.addListener(y, "dragend", function (e) {
      T(u, g, f, e.latLng);
      jQuery('input[name="felan_map_location"]').val(
        e.latLng.lat() + "," + e.latLng.lng()
      );
    });
    google.maps.event.addListener(y, "click", function (e) {
      f.open(g, y);
      jQuery('input[name="felan_map_location"]').val(
        e.latLng.lat() + "," + e.latLng.lng()
      );
    });
  }
  function T(e, m, p, c) {
    var t = function (e) {
      var t = _.find(e, function (e) {
        return e.types[0] == "locality" && e.types[1] == "political";
      });
      if (!t) {
        var t = _.find(e, function (e) {
          return (
            e.types[0] == "administrative_area_level_1" &&
            e.types[1] == "political"
          );
        });
      }
      return t ? t.short_name : null;
    };
    e.geocode({ location: c }, function (e, t) {
      if (t === "OK") {
        if (e[0]) {
          y.setPosition(c);
          var o = Math.pow(2, m.getZoom()),
            l = 50 / o || 0,
            a = m.getProjection(),
            n = y.getPosition(),
            r = a.fromLatLngToPoint(n),
            i = new google.maps.Point(r.x, r.y - l),
            s = a.fromPointToLatLng(i);
          m.panTo(s);
          p.close();
          p.setContent(e[0].formatted_address);
          p.open(m, y);
          document.getElementById("search-location").value =
            e[0].formatted_address;
        } else {
          window.alert("No results found");
        }
      } else {
        window.alert("Geocoder failed due to: " + t);
      }
    });
  }
  function b(e) {
    y.setMap(e);
  }
  function w() {
    b(null);
  }
  function L() {
    b(g);
  }
  function h() {
    var e = document.getElementById("search-location");
    var o = new google.maps.places.Autocomplete(e);
    document.getElementById("geocoder").style.display = "none";
    o.bindTo("bounds", g);
    o.setFields(["address_components", "geometry", "icon", "name"]);
    var t = function (e) {
      var t = _.find(e, function (e) {
        return e.types[0] == "locality" && e.types[1] == "political";
      });
      if (!t) {
        var t = _.find(e, function (e) {
          return (
            e.types[0] == "administrative_area_level_1" &&
            e.types[1] == "political"
          );
        });
      }
      return t ? t.short_name : null;
    };
    o.addListener("place_changed", function () {
      f.close();
      y.setVisible(false);
      var e = o.getPlace();
      if (!e.geometry) {
        window.alert("No details available for input: '" + e.name + "'");
        return;
      }
      if (e.geometry.viewport) {
        g.fitBounds(e.geometry.viewport);
      } else {
        g.setCenter(e.geometry.location);
        g.setZoom(12);
      }
      y.setPosition(e.geometry.location);
      y.setVisible(true);
      var t = "";
      if (e.address_components) {
        t = [
          (e.address_components[0] && e.address_components[0].short_name) || "",
          (e.address_components[1] && e.address_components[1].short_name) || "",
          (e.address_components[2] && e.address_components[2].short_name) || "",
        ].join(" ");
      }
      jQuery('input[name="felan_map_location"]').val(
        e.geometry.location.lat() + "," + e.geometry.location.lng()
      );
      jQuery('input[name="felan_longtitude"]').val(e.geometry.location.lng());
      jQuery('input[name="felan_latitude"]').val(e.geometry.location.lat());
      f.setContent(t);
      f.open(g, y);
    });
  }
});
