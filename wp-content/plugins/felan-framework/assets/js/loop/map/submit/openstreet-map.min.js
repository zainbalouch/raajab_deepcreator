jQuery(document).ready(function () {
  var t = felan_openstreet_map_submit_vars.api_key,
    e = felan_openstreet_map_submit_vars.lng,
    a = felan_openstreet_map_submit_vars.lat,
    i = felan_openstreet_map_submit_vars.map_zoom,
    o = felan_openstreet_map_submit_vars.map_style,
    r = felan_openstreet_map_submit_vars.map_marker,
    n = felan_openstreet_map_submit_vars.form_submit;
  var a = parseFloat(a),
    e = parseFloat(e),
    s = jQuery(n).find('input[name="felan_map_location"]'),
    p = jQuery(n).find('input[name="felan_map_address"]'),
    c = jQuery(n).find('input[name="felan_longtitude"]'),
    l = jQuery(n).find('input[name="felan_latitude"]');
  var m = new L.map("openstreetmap_location");
  var u = L.esri.Geocoding.geosearch().addTo(m);
  var v = L.layerGroup().addTo(m);
  var d = {
    type: "FeatureCollection",
    features: [
      {
        type: "Feature",
        geometry: { type: "Point", coordinates: [a, e] },
        properties: { iconSize: [48, 48], icon: r },
      },
    ],
  };
  var _ = L.DomUtil.get("openstreetmap_map");
  if (_ != null) {
    _._leaflet_id = null;
  }
  d.features.forEach(function (e, t) {
    e.properties.id = t;
  });
  function f() {
    var e = "mapbox/" + o;
    L.tileLayer(
      "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=" +
        t,
      {
        attribution:
          'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        id: e,
        tileSize: 512,
        zoomOffset: -1,
        accessToken: t,
      }
    ).addTo(m);
    h();
  }
  m.on("load", f);
  m.setView([a, e], i);
  if (!("remove" in Element.prototype)) {
    Element.prototype.remove = function () {
      if (this.parentNode) {
        this.parentNode.removeChild(this);
      }
    };
  }
  u.on("results", function (e) {
    v.clearLayers();
    for (var t = e.results.length - 1; t >= 0; t--) {
      p.val(e.results[t].text);
      y(e.results[t].latlng["lng"], e.results[t].latlng["lat"]);
    }
  });
  m.on("click", function (e) {
    y(e.latlng.lng, e.latlng.lat);
  });
  function y(e, t) {
    s.val(t + "," + e);
    if (s.val() !== "") {
      c.val(e);
      l.val(t);
    }
  }
  function g(e) {
    m.flyTo(e.geometry.coordinates, osm_level);
  }
  function h() {
    d.features.forEach(function (a) {
      var e = document.createElement("div");
      e.id = "marker-" + a.properties.id;
      e.className = "marker";
      e.style.backgroundImage = "url(" + r + ")";
      e.style.width = a.properties.iconSize[0] + "px";
      e.style.height = a.properties.iconSize[1] + "px";
      var t = L.Icon.extend({
        options: {
          className: "marker-" + a.properties.id,
          iconSize: [40, 40],
          shadowSize: [50, 64],
          iconAnchor: [20, 20],
          shadowAnchor: [4, 62],
          popupAnchor: [0, -12],
        },
      });
      var i = new t({ iconUrl: r });
      new L.marker([a.geometry.coordinates[0], a.geometry.coordinates[1]], {
        icon: i,
      }).addTo(m);
      e.addEventListener("click", function (e) {
        g(a);
        var t = document.getElementsByClassName("active");
        e.stopPropagation();
        if (t[0]) {
          t[0].classList.remove("active");
        }
      });
    });
  }
});
