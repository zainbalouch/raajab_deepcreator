(function (n) {
  "use strict";
  var l = felan_avatar_vars.ajax_url,
    o = felan_avatar_vars.avatar_title,
    i = felan_avatar_vars.avatar_type,
    c = felan_avatar_vars.avatar_file_size,
    d = felan_avatar_vars.avatar_text,
    _ = felan_avatar_vars.avatar_url,
    v = felan_avatar_vars.avatar_upload_nonce;
  jQuery(document).ready(function () {
    var a = function () {
      var e = new plupload.Uploader({
        browse_button: "felan_select_avatar",
        file_data_name: "felan_avatar_upload_file",
        drop_element: "felan_avatar_view",
        container: "felan_avatar_container",
        url: _,
        filters: {
          mime_types: [{ title: o, extensions: i }],
          max_file_size: c,
          prevent_duplicates: true,
        },
      });
      e.init();
      e.bind("UploadProgress", function (a, r) {
        n("#felan_add_avatar .la-upload").hide();
        document.getElementById("felan_select_avatar").innerHTML =
          '<span><i class="fal fa-spinner fa-spin large"></i></span>';
      });
      e.bind("FilesAdded", function (a, r) {
        a.refresh();
        e.start();
      });
      e.bind("Error", function (a, r) {
        document.getElementById("felan_avatar_errors").innerHTML +=
          "Error #" + r.code + ": " + r.message + "<br/>";
      });
      var a = n("#felan_avatar_view").data("image-id");
      var r = n("#felan_avatar_view").data("image-url");
      if (a && r) {
        var t =
          '<figure class="media-thumb media-thumb-wrap">' +
          '<img src="' +
          r +
          '">' +
          '<div class="media-item-actions">' +
          '<a class="icon icon-avatar-delete" data-attachment-id="' +
          a +
          '" href="#" ><i class="far fa-trash-alt large"></i></a>' +
          '<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
          "</div>" +
          "</figure>";
        n("#felan_avatar_view").html(t);
        n("#felan_add_avatar").hide();
      }
      e.bind("FileUploaded", function (a, r, e) {
        document.getElementById("felan_drop_avatar").style.display = "none";
        var t = n.parseJSON(e.response);
        if (t.success) {
          n("input.avatar_url").val(t.full_image);
          n("input.avatar_id").val(t.attachment_id);
          var o =
            '<figure class="media-thumb media-thumb-wrap">' +
            '<img src="' +
            t.full_image +
            '">' +
            '<div class="media-item-actions">' +
            '<a class="icon icon-avatar-delete" data-attachment-id="' +
            t.attachment_id +
            '" href="#" ><i class="far fa-trash-alt large"></i></a>' +
            '<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
            "</div>" +
            "</figure>";
          n("#felan_avatar_view").html(o);
          s();
          n("#felan_add_avatar .la-upload").hide();
          n("#avatar_url-error").hide();
          if (n(".form-dashboard").hasClass("freelancer-profile-form")) {
            n("#freelancer-profile-form").find(".point-mark").change();
          }
        }
        var i = n("#submit_company_form input.avatar_url");
        console.log(i.val());
        var c = n(".about-company-dashboard");
        c.find(".img-company").html('<img src="' + i.val() + '" alt="">');
      });
    };
    a();
    var s = function (c) {
      n("body").on("click", ".icon-avatar-delete", function (a) {
        a.preventDefault();
        var r = n(this),
          e = r,
          t = r.closest("#felan_avatar_view").find(".media-thumb-wrap"),
          o = r.data("attachment-id"),
          i = n("#felan_drop_avatar");
        e.html('<i class="fal fa-spinner fa-spin large"></i>');
        n.ajax({
          type: "post",
          url: l,
          dataType: "json",
          data: {
            action: "felan_avatar_remove_ajax",
            attachment_id: o,
            type: c,
            removeNonce: v,
          },
          success: function (a) {
            if (a.success) {
              t.remove();
              t.hide();
              n("#avatar_url-error").show();
              n("#felan_add_avatar").show();
            }
            e.html('<i class="fal fa-spinner fa-spin large"></i>');
            i.css("display", "block");
            n("#felan_add_avatar .la-upload").show();
            n("#felan_select_avatar").html(d);
            n("input.avatar_url").val("");
            n("input.avatar_id").val("");
            if (n(".form-dashboard").hasClass("freelancer-profile-form")) {
              n("#freelancer-profile-form").find(".point-mark").change();
            }
            var r = n(".about-company-dashboard");
            r.find(".img-company").html('<i class="far fa-camera"></i>');
          },
          error: function () {
            e.html('<i class="far fa-trash-alt large"></i>');
          },
        });
      });
    };
    s();
  });
})(jQuery);
