(function (o) {
  "use strict";
  var t = felan_gallery_vars.ajax_url,
    a = felan_gallery_vars.gallery_title,
    r = felan_gallery_vars.gallery_type,
    s = felan_gallery_vars.gallery_max_images,
    l = felan_gallery_vars.gallery_file_size,
    c = felan_gallery_vars.gallery_url,
    d = felan_gallery_vars.gallery_upload_nonce;
  jQuery(document).ready(function () {
    var e = function () {
      o("#felan_gallery_thumbs").sortable();
      var i = new plupload.Uploader({
        browse_button: "felan_select_gallery",
        file_data_name: "felan_gallery_upload_file",
        container: "felan_gallery_container",
        drop_element: "felan_gallery_container",
        multi_selection: true,
        url: c,
        filters: {
          mime_types: [{ title: a, extensions: r }],
          max_file_size: l,
          prevent_duplicates: true,
        },
      });
      i.init();
      i.bind("FilesAdded", function (e, a) {
        var r = "";
        var l = s;
        if (e.files.length > l) {
          e.splice(l);
          alert("no more than " + l + " file(s)");
          return;
        }
        plupload.each(a, function (e) {
          r += '<div id="holder-' + e.id + '"></div>';
        });
        document.getElementById("felan_gallery_thumbs").innerHTML += r;
        e.refresh();
        i.start();
      });
      i.bind("UploadProgress", function (e, a) {
        document.getElementById("holder-" + a.id).innerHTML =
          '<span><i class="fal fa-spinner fa-spin large"></i></span>';
      });
      i.bind("Error", function (e, a) {
        document.getElementById("felan_gallery_errors").innerHTML +=
          "Error: " + a.message + "<br/>";
      });
      i.bind("FileUploaded", function (e, a, r) {
        var l = o.parseJSON(r.response);
        if (l.success) {
          var i =
            '<figure class="media-thumb media-thumb-wrap">' +
            '<img src="' +
            l.url +
            '"/>' +
            '<div class="media-item-actions">' +
            '<a class="icon icon-gallery-delete" data-attachment-id="' +
            l.attachment_id +
            '" href="#" ><i class="far fa-trash-alt large"></i></a>' +
            '<input type="hidden" class="felan_gallery_ids" name="felan_gallery_ids[]" value="' +
            l.attachment_id +
            '"/>' +
            '<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
            "</div>" +
            "</figure>";
          document.getElementById("holder-" + a.id).innerHTML = i;
          n("gallery");
          if (o(".form-dashboard").hasClass("freelancer-profile-form")) {
            o("#freelancer-profile-form").find(".point-mark").change();
          }
        }
      });
    };
    e();
    var n = function (n) {
      o("body").on("click", ".icon-gallery-delete", function (e) {
        e.preventDefault();
        var a = o(this),
          r = a,
          l = a.closest(".media-thumb-wrap"),
          i = a.data("attachment-id");
        r.html('<i class="fal fa-spinner fa-spin large"></i>');
        o.ajax({
          type: "post",
          url: t,
          dataType: "json",
          data: {
            action: "felan_gallery_remove_ajax",
            attachment_id: i,
            type: n,
            removeNonce: d,
          },
          success: function (e) {
            if (e.success) {
              l.remove();
              l.hide();
              o("#featured_image_url-error").show();
            }
            r.html('<i class="fal fa-spinner fa-spin large"></i>');
            if (o(".form-dashboard").hasClass("freelancer-profile-form")) {
              o("#freelancer-profile-form").find(".point-mark").change();
            }
          },
          error: function () {
            r.html('<i class="far fa-trash-alt large"></i>');
          },
        });
      });
    };
    n("gallery");
  });
})(jQuery);
