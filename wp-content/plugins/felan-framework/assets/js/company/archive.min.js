(function (x) {
  "use strict";
  var P = felan_template_vars.ajax_url,
    O = felan_template_vars.item_amount,
    N = felan_template_vars.map_effects,
    M = felan_company_archive_vars.not_company,
    a = felan_company_archive_vars.range_min,
    t = felan_company_archive_vars.range_max;
  var l = false;
  var w = x(".felan-menu-filter");
  var A = x(".archive-company");
  var I = x(".maptype").data("maptype");
  var j = false;
  var Y = "";
  if (I == "google_map") {
    var e = x("#company-map-filter");
  } else if (I == "openstreetmap") {
    var e = x("#maps");
  } else {
    var e = x("#map");
  }
  if (e.length) {
    Y = "yes";
  }
  if (
    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
      navigator.userAgent
    )
  ) {
    j = true;
  }
  var z = function () {
    if (N !== "" && Y) {
      x(".map-event .area-company .felan-company-item").each(function () {
        var e = x(this).find(".add-follow-company").data("company-id");
        if (I == "google_map") {
        } else if (I == "openstreetmap") {
          x(this).on("mouseenter", function () {
            if (N == "popup") {
              x(".marker-" + e)
                .trigger("click")
                .css("z-index", "2");
            } else if (N == "shine") {
              x(".marker-" + e)
                .trigger("click")
                .addClass("mouseenter");
            }
          });
          x(this).on("mouseleave", function () {
            if (N == "popup") {
              x(".marker-" + e).css("z-index", "0");
              x(".leaflet-popup-close-button").trigger("click");
            } else if (N == "shine") {
              x(".marker-" + e)
                .trigger("click")
                .removeClass("mouseenter");
            }
          });
        } else {
          x(this).on("mouseenter", function () {
            if (N == "popup") {
              x("#marker-" + e)
                .trigger("click")
                .css("z-index", "2");
            } else if (N == "shine") {
              x("#marker-" + e)
                .trigger("click")
                .addClass("mouseenter");
            }
          });
          x(this).on("mouseleave", function () {
            if (N == "popup") {
              x(".marker-" + e).css("z-index", "0");
              x(".mapboxgl-popup-close-button").trigger("click");
            } else if (N == "shine") {
              x("#marker-" + e)
                .trigger("click")
                .removeClass("mouseenter");
            }
          });
        }
      });
    }
  };
  COMPANY.elements = {
    init: function () {
      this.company_layout();
      this.slider_range();
      this.pagination();
      this.display_clear();
      this.filter_clear_top();
      this.filter_clear();
      A.find(".felan-menu-filter").on(
        "input",
        "input.input-control",
        function () {
          x(".felan-pagination").find('input[name="paged"]').val(1);
          x(".form-company-top-filter .btn-top-filter").removeData("clicked");
          l = true;
          COMPANY.elements.ajax_load(l);
        }
      );
      A.find("select.sort-by").on("change", function () {
        x(".felan-pagination").find('input[name="paged"]').val(1);
        x(".form-company-top-filter .btn-top-filter").removeData("clicked");
        l = true;
        COMPANY.elements.ajax_load(l);
      });
      A.find(".form-company-top-filter .btn-top-filter").on(
        "click",
        function (e) {
          e.preventDefault();
          x(".felan-pagination").find('input[name="paged"]').val(1);
          x(this).data("clicked", true);
          l = true;
          COMPANY.elements.ajax_load(l);
        }
      );
      if (e.length > 0) {
        COMPANY.elements.ajax_load();
      }
      x('.btn-hide-map input[type="checkbox"]').on("change", function () {
        var e = x(".archive-layout .inner-content");
        var a = x(".layout-top-filter .nav-bar");
        if (x(this).attr("checked")) {
          x("input[value='hide_map']").prop("checked", false);
        } else {
          x("input[value='hide_map']").prop("checked", true);
        }
        if (e.hasClass("has-map")) {
          e.removeClass("has-map");
          e.addClass("no-map");
          a.removeClass("has-map");
          a.addClass("no-map");
        } else {
          e.removeClass("no-map");
          e.addClass("has-map");
          a.removeClass("no-map");
          a.addClass("has-map");
        }
        l = true;
        COMPANY.elements.ajax_load(l);
      });
    },
    slider_range: function () {
      var n = x(".archive-company");
      var o = parseInt(a);
      var r = parseInt(t);
      var i = {};
      function e(e, a) {
        clearTimeout(i[e]);
        i[e] = setTimeout(function () {
          x(".felan-pagination").find('input[name="paged"]').val(1);
          x(this).data("clicked", true);
          l = true;
          COMPANY.elements.ajax_load(l);
        }, 500);
      }
      x("#slider-range").slider({
        range: true,
        min: o,
        max: r,
        step: 1,
        values: [o, r],
        slide: function (e, a) {
          x("#amount").val(a.values[0] + " - " + a.values[1]);
        },
        change: function (e, a) {
          var i = a.values[0];
          var t = a.values[1];
          if (i !== o || t !== r) {
            n.addClass("filter-active");
          } else {
            n.removeClass("filter-active");
          }
        },
        stop: function () {
          e();
        },
      });
      x("#amount").val(
        x("#slider-range").slider("values", 0) +
          " - " +
          x("#slider-range").slider("values", 1)
      );
    },
    pagination: function () {
      x("body").on(
        "click",
        ".felan-pagination.ajax-call a.page-numbers",
        function (e) {
          e.preventDefault();
          A.find(".felan-pagination .pagination").addClass("active");
          A.find(".felan-pagination li .page-numbers").removeClass("current");
          x(this).addClass("current");
          var a = x(this).text();
          var i = 1;
          if (x(".felan-pagination").find('input[name="paged"]').val()) {
            i = x(".felan-pagination").find('input[name="paged"]').val();
          }
          if (x(this).hasClass("next")) {
            a = parseInt(i) + 1;
          }
          if (x(this).hasClass("prev")) {
            a = parseInt(i) - 1;
          }
          A.find(".felan-pagination").find('input[name="paged"]').val(a);
          l = true;
          if (x(this).attr("data-type") == "number") {
            COMPANY.elements.scroll_to(".area-company");
            COMPANY.elements.ajax_load(l);
          } else {
            COMPANY.elements.ajax_load(l, "loadmore");
          }
        }
      );
    },
    removeClassStartingWith: function (e, i) {
      e.removeClass(function (e, a) {
        return (a.match(new RegExp("\\b" + i + "\\S+", "g")) || []).join(" ");
      });
    },
    company_layout: function () {
      A.find(".company-layout a").on("click", function (e) {
        e.preventDefault();
        var a = x(this).attr("data-layout");
        var i = x(".felan-pagination").attr("data-type");
        if (i == "loadmore") {
          x(".felan-pagination").find('input[name="paged"]').val(1);
        }
        x(this).closest(".company-layout").find(">a").removeClass("active");
        x(this).addClass("active");
        COMPANY.elements.removeClassStartingWith(
          x(".archive-layout>.inner-content"),
          "layout-"
        );
        x(this).closest(".inner-content").addClass(a);
        x(".form-company-top-filter .btn-top-filter").removeData("clicked");
        x(".area-company .felan-company-item").each(function () {
          COMPANY.elements.removeClassStartingWith(x(this), "layout-");
          x(this).addClass(a);
        });
        l = true;
        COMPANY.elements.ajax_load(l);
      });
    },
    display_clear: function () {
      var e = x(".archive-company");
      if (x(".felan-menu-filter ul.filter-control li.active").length > 0) {
        x(".felan-nav-filter").addClass("active");
        e.find(".felan-clear-filter").show();
      } else {
        x(".felan-nav-filter").removeClass("active");
        e.find(".felan-clear-filter").hide();
      }
      x('.felan-menu-filter input[type="checkbox"]:checked').each(function () {
        if (x(this).length > 0) {
          x(".felan-nav-filter").addClass("active");
          x(this).closest(".entry-filter").addClass("open");
          e.find(".felan-clear-filter").show();
        } else {
          x(".felan-nav-filter").removeClass("active");
          x(this).closest(".entry-filter").removeClass("open");
          e.find(".felan-clear-filter").hide();
        }
      });
    },
    filter_clear_top: function () {
      A.find(".felan-clear-top-filter").on("click", function () {
        x('.form-company-top-filter input[name="company_filter_search"]').val(
          ""
        );
        x(".form-company-top-filter .nice-select").val("");
        x(".form-company-top-filter .nice-select").niceSelect("update");
        l = true;
        COMPANY.elements.ajax_load(l);
      });
    },
    filter_clear: function () {
      A.find(".felan-clear-filter").on("click", function () {
        x(".felan-menu-filter ul.filter-control li").removeClass("active");
        x('.felan-menu-filter input[type="checkbox"]').prop("checked", false);
        x('.felan-menu-filter select[name="company_filter_salary_min"]').prop(
          "selectedIndex",
          0
        );
        x('.felan-menu-filter select[name="company_filter_salary_max"]').prop(
          "selectedIndex",
          0
        );
        x('.felan-menu-filter select[name="company_filter_rate"]').prop(
          "selectedIndex",
          0
        );
        x("#slider-range").slider("values", 0, parseInt(a));
        x("#slider-range").slider("values", 1, parseInt(t));
        x("#amount").val(parseInt(a) + " - " + parseInt(t));
        l = true;
        COMPANY.elements.ajax_load(l);
      });
    },
    ajax_load: function (a, i) {
      var e, t, n, o, r, l, c, s, p, m, d, f, v;
      var u = 1;
      u = A.find(".felan-pagination").find('input[name="paged"]').val();
      e = A.find('input[name="company_filter_search"]').val();
      s = x('input[name="current_term"]').val();
      p = x('input[name="type_term"]').val();
      v = A.find(".company-layout a.active").attr("data-layout");
      t = w.find(".sort-by.filter-control li.active a").data("sort");
      var g = x('.archive-layout select[name="sort_by"]').val();
      if (g) {
        t = g;
      }
      f = x('input[name="search_fields_sidebar"]').val();
      var y = x.parseJSON(f);
      if (y.hasOwnProperty("company-founded")) {
        n = A.find("#slider-range").slider("values", 0);
        r = A.find("#slider-range").slider("values", 1);
      } else {
        o = A.find('select[name="company-founded"]').val();
      }
      if (y.hasOwnProperty("company-location")) {
        c = x('input[name="company-location_id[]"]:checked')
          .map(function () {
            return x(this).val();
          })
          .get();
      } else {
        c = x('select[name="company-location"]').val();
      }
      if (y.hasOwnProperty("company-categories")) {
        l = x('input[name="company-categories_id[]"]:checked')
          .map(function () {
            return x(this).val();
          })
          .get();
      } else {
        l = x('select[name="company-categories"]').val();
      }
      if (y.hasOwnProperty("company-size")) {
        m = x('input[name="company-size_id[]"]:checked')
          .map(function () {
            return x(this).val();
          })
          .get();
      } else {
        m = x('select[name="company-size"]').val();
      }
      if (y.hasOwnProperty("company-rating")) {
        d = x('input[name="company_rating[]"]:checked')
          .map(function () {
            return x(this).val();
          })
          .get();
      } else {
        d = x('select[name="company-rating"]').val();
      }
      var _ = x(".maptype").clone();
      if (I == "google_map") {
      } else if (I == "openstreetmap") {
        var h = function (e, a) {
          x(".maptype").remove();
          x(_).insertAfter("#pac-input");
          var i = x("#maps").data("key");
          var t = x("#maps").data("level");
          var n = x("#maps").data("style");
          var o = [];
          var r = [];
          var l = [];
          x.each(e, function (e, a) {
            o.push({
              type: "Feature",
              geometry: { type: "Point", coordinates: [a.lat, a.lng] },
              properties: {
                iconSize: [40, 40],
                id: a.id,
                icon: a.marker_icon,
                company: a.company,
              },
            });
            r.push(a.lng);
            l.push(a.lat);
          });
          var c = { type: "FeatureCollection", features: o };
          var s = 0;
          for (var p = 0; p < r.length; p++) {
            s += parseInt(r[p], 10);
          }
          var m = 0;
          if (s / r.length) {
            m = s / r.length;
          }
          var d = 0;
          for (var p = 0; p < l.length; p++) {
            d += parseInt(l[p], 10);
          }
          var f = 0;
          if (d / l.length) {
            f = d / l.length;
          }
          var v = L.DomUtil.get("maps");
          if (v != null) {
            v._leaflet_id = null;
          }
          x(".leaflet-map-pane").remove();
          x(".leaflet-control-container").remove();
          var u = new L.map("maps");
          u.on("load", g);
          u.setView([f, m], t);
          function g() {
            var e = "mapbox/" + n;
            L.tileLayer(
              "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=" +
                i,
              {
                attribution:
                  'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                id: e,
                tileSize: 512,
                zoomOffset: -1,
                accessToken: i,
              }
            ).addTo(u);
            h();
          }
          function y(e) {
            u.flyTo(e.geometry.coordinates, t);
          }
          if (!("remove" in Element.prototype)) {
            Element.prototype.remove = function () {
              if (this.parentNode) {
                this.parentNode.removeChild(this);
              }
            };
          }
          function h() {
            c.features.forEach(function (i) {
              var e = document.createElement("div");
              e.id = "marker-" + i.properties.id;
              e.className = "marker";
              e.style.backgroundImage = "url(" + i.properties.icon + ")";
              e.style.width = i.properties.iconSize[0] + "px";
              e.style.height = i.properties.iconSize[1] + "px";
              e: {
              }
              var a = L.divIcon({
                className: "marker-" + i.properties.id,
                html: '<div><img src="' + i.properties.icon + '" alt=""></div>',
                iconSize: [48, 48],
              });
              var t = new L.marker(
                [i.geometry.coordinates[0], i.geometry.coordinates[1]],
                { icon: a }
              );
              t.addTo(u);
              if (N == "popup") {
                t.bindPopup(i.properties.company);
              } else {
                t.bindPopup();
              }
              e.addEventListener("click", function (e) {
                y(i);
                var a = document.getElementsByClassName("active");
                e.stopPropagation();
                if (a[0]) {
                  a[0].classList.remove("active");
                }
              });
            });
          }
          if (!j) {
            z();
          }
        };
      } else {
        var C = function (e, t) {
          var a = x("#map").data("key");
          var i = x("#map").data("level");
          var n = x("#map").data("type");
          mapboxgl.accessToken = a;
          x(".mapboxgl-canary").remove();
          x(".mapboxgl-canvas-container").remove();
          x(".mapboxgl-control-container").remove();
          var o = [];
          var r = [];
          var l = [];
          x.each(e, function (e, a) {
            o.push({
              type: "Feature",
              geometry: { type: "Point", coordinates: [a.lng, a.lat] },
              properties: {
                iconSize: [48, 48],
                id: a.id,
                icon: a.marker_icon,
                company: a.company,
              },
            });
            r.push(a.lng);
            l.push(a.lat);
          });
          var c = 0;
          for (var s = 0; s < r.length; s++) {
            c += parseInt(r[s], 10);
          }
          var p = 0;
          if (c / r.length) {
            p = c / r.length;
          }
          var m = 0;
          for (var s = 0; s < l.length; s++) {
            m += parseInt(l[s], 10);
          }
          var d = 0;
          if (m / l.length) {
            d = m / l.length;
          }
          var t = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/mapbox/" + n,
            zoom: i,
            center: [p, d],
          });
          t.addControl(new mapboxgl.NavigationControl());
          var f = { type: "FeatureCollection", features: o };
          t.on("load", function (e) {
            t.addLayer({
              id: "locations",
              type: "symbol",
              source: { type: "geojson", data: f },
              layout: { "icon-image": "", "icon-allow-overlap": true },
            });
            g();
          });
          function v(e) {
            t.flyTo({
              center: e.geometry.coordinates,
              bearing: 0,
              duration: 0,
              speed: 0.2,
              curve: 1,
              easing: function (e) {
                return e;
              },
            });
          }
          function u(e) {
            var a = document.getElementsByClassName("mapboxgl-popup");
            if (a[0]) a[0].remove();
            var i = new mapboxgl.Popup({ closeOnClick: false })
              .setLngLat(e.geometry.coordinates)
              .setHTML(e.properties.company)
              .addTo(t);
          }
          if (!("remove" in Element.prototype)) {
            Element.prototype.remove = function () {
              if (this.parentNode) {
                this.parentNode.removeChild(this);
              }
            };
          }
          t.on("click", function (e) {
            var a = t.queryRenderedFeatures(e.point, { layers: ["locations"] });
            if (a.length) {
              var i = a[0];
              v(i);
              u(i);
            }
          });
          function g() {
            f.features.forEach(function (i) {
              var e = document.createElement("div");
              e.id = "marker-" + i.properties.id;
              e.className = "marker";
              e.style.backgroundImage = "url(" + i.properties.icon + ")";
              e.style.width = i.properties.iconSize[0] + "px";
              e.style.height = i.properties.iconSize[1] + "px";
              new mapboxgl.Marker(e, { offset: [0, -23] })
                .setLngLat(i.geometry.coordinates)
                .addTo(t);
              e.addEventListener("click", function (e) {
                v(i);
                if (N == "popup") {
                  u(i);
                }
                var a = document.getElementsByClassName("active");
                e.stopPropagation();
                if (a[0]) {
                  a[0].classList.remove("active");
                }
              });
            });
          }
        };
        if (!j) {
          z();
        }
      }
      COMPANY.elements.display_clear();
      var k = x(".area-company").attr("data-item-amount");
      if (k) {
        O = k;
      }
      var b = x(".felan-pagination").attr("data-type");
      x(".area-company .felan-company-item").addClass("skeleton-loading");
      x.ajax({
        dataType: "json",
        url: P,
        data: {
          action: "felan_company_archive_ajax",
          paged: u,
          title: e,
          item_amount: O,
          sort_by: t,
          current_term: s,
          type_term: p,
          size: m,
          rating: d,
          range_min: n,
          range_max: r,
          founded: o,
          location: c,
          categories: l,
          company_layout: v,
        },
        beforeSend: function () {
          A.find(".felan-filter-search-map .felan-loading-effect").fadeIn();
          if (
            A.find(".form-company-top-filter .btn-top-filter").data("clicked")
          ) {
            A.find(".btn-top-filter .btn-loading").fadeIn();
          }
          if (b == "loadmore") {
            A.find(".btn-loading").fadeIn();
          }
        },
        success: function (e) {
          A.find(".btn-top-filter .btn-loading").fadeOut();
          A.find(".felan-filter-search-map .felan-loading-effect").fadeOut();
          x(".area-company .felan-company-item").removeClass(
            "skeleton-loading"
          );
          if (e.success === true) {
            if (a == true) {
              if (e.pagination_type == "number" || i !== "loadmore") {
                A.find(".area-company").html(e.company_html);
                A.find(".felan-pagination .pagination").html(e.pagination);
                A.find(".result-count").html(e.count_post);
              } else {
                A.find(".area-company").append(e.company_html);
                if (e.hidden_pagination) {
                  A.find(".felan-pagination .pagination").html("");
                }
                A.find(".btn-loading").fadeOut();
                A.find(".felan-pagination .pagination").removeClass("active");
              }
            }
          } else {
            if (a == true) {
              if (e.pagination_type == "number" || i !== "loadmore") {
                A.find(".area-company").html(
                  '<div class="felan-ajax-result">' + M + "</div>"
                );
                A.find(".result-count").html(e.count_post);
                A.find(".felan-pagination .pagination").html("");
              } else {
                A.find(".area-company").append(e.company_html);
                if (e.hidden_pagination) {
                  x(".felan-pagination .pagination").html("");
                }
                A.find(".felan-pagination .pagination").removeClass("active");
              }
            }
          }
          if (!j) {
            z();
          }
          if (Y) {
            if (I == "google_map") {
            } else if (I == "openstreetmap") {
              h(e.company, maps);
            } else {
              C(e.company, map);
            }
          }
        },
      });
    },
  };
  COMPANY.onReady = {
    init: function () {
      COMPANY.elements.init();
    },
  };
  COMPANY.onLoad = { init: function () {} };
  x(document).ready(function () {
    COMPANY.elements.init();
  });
  x(window).load(COMPANY.onLoad.init);
})(jQuery);
