var FELAN_SERVICE_STRIPE = FELAN_SERVICE_STRIPE || {};
(function (t) {
  "use strict";
  FELAN_SERVICE_STRIPE = {
    init: function () {
      this.setupForm();
    },
    setupForm: function () {
      var e = this,
        c = t(".felan-freelancer-stripe-form");
      if (c.length === 0) return;
      var a = c.attr("id");
      var n = felan_stripe_vars[a];
      var o = null;
      var r = c.find(".felan-stripe-button");
      if (r.length) {
        o = StripeCheckout.configure({
          key: n.key,
          locale: "auto",
          token: function (e, a) {
            t("<input>")
              .attr({ type: "hidden", name: "stripeToken", value: e.id })
              .appendTo(c);
            t("<input>")
              .attr({ type: "hidden", name: "stripeTokenType", value: e.type })
              .appendTo(c);
            if (e.email) {
              t("<input>")
                .attr({ type: "hidden", name: "stripeEmail", value: e.email })
                .appendTo(c);
            }
            c.submit();
          },
        });
        r.on("click", function (e) {
          e.preventDefault();
          o.open(n.params);
        });
      }
      window.addEventListener("popstate", function () {
        if (o != null) {
          o.close();
        }
      });
    },
  };
  t(document).ready(function () {
    FELAN_SERVICE_STRIPE.init();
    if (typeof felan_payment_vars !== "undefined") {
      var a = felan_payment_vars.ajax_url;
      var e = felan_payment_vars.processing_text;
      t("#felan_payment_freelancer_package").on("click", function (e) {
        var a = t(
          "input[name='felan_freelancer_payment_method']:checked"
        ).val();
        var c = t("input[name='felan_freelancer_package_id']").val();
        if (a == "paypal") {
          n(c);
        } else if (a == "stripe") {
          t("#felan_stripe_freelancer_per_package button").trigger("click");
        } else if (a == "wire_transfer") {
          o(c);
        } else if (a == "woocheckout") {
          r(c);
        }
      });
      var n = function (e) {
        t.ajax({
          type: "POST",
          url: a,
          data: {
            action: "felan_freelancer_paypal_payment_per_package_ajax",
            freelancer_package_id: e,
            felan_freelancer_security_payment: t(
              "#felan_freelancer_security_payment"
            ).val(),
          },
          beforeSend: function () {
            t("#felan_payment_freelancer_package").append(
              '<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>'
            );
          },
          success: function (e) {
            window.location.href = e;
          },
        });
      };
      var c = function (e) {
        t.ajax({
          type: "POST",
          url: a,
          data: {
            action: "felan_freelancer_paypal_payment_per_package_ajax",
            freelancer_package_id: e,
            felan_freelancer_security_payment: t(
              "#felan_freelancer_security_payment"
            ).val(),
          },
          beforeSend: function () {
            t("#felan_payment_freelancer_package").append(
              '<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>'
            );
          },
          success: function (e) {
            window.location.href = e;
          },
        });
      };
      var o = function (e) {
        t.ajax({
          type: "POST",
          url: a,
          data: {
            action: "felan_freelancer_wire_transfer_per_package_ajax",
            freelancer_package_id: e,
            felan_freelancer_security_payment: t(
              "#felan_freelancer_security_payment"
            ).val(),
          },
          beforeSend: function () {
            t("#felan_payment_freelancer_package").append(
              '<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>'
            );
          },
          success: function (e) {
            window.location.href = e;
          },
        });
      };
      t("#felan_free_freelancer_package").on("click", function () {
        var e = t("input[name='felan_freelancer_package_id']").val();
        t.ajax({
          type: "POST",
          url: a,
          data: {
            action: "felan_freelancer_free_package_ajax",
            freelancer_package_id: e,
            felan_freelancer_security_payment: t(
              "#felan_freelancer_security_payment"
            ).val(),
          },
          beforeSend: function () {
            t("#felan_payment_freelancer_package").append(
              '<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>'
            );
          },
          success: function (e) {
            window.location.href = e;
          },
        });
      });
      var r = function (e) {
        t.ajax({
          type: "POST",
          url: a,
          data: {
            action: "felan_freelancer_woocommerce_payment_per_package_ajax",
            freelancer_package_id: e,
            felan_freelancer_security_payment: t(
              "#felan_freelancer_security_payment"
            ).val(),
          },
          beforeSend: function () {
            t("#felan_payment_freelancer_package").append(
              '<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>'
            );
          },
          success: function (e) {
            window.location.href = e;
          },
        });
      };
    }
  });
})(jQuery);
