goog.provide("webfont.FontWatcher");goog.require("webfont.FontWatchRunner");goog.require("webfont.NativeFontWatchRunner");webfont.FontTestStrings;webfont.FontWatcher=function(t,e,n){this.domHelper_=t;this.eventDispatcher_=e;this.currentlyWatched_=0;this.last_=false;this.success_=false;this.timeout_=n};goog.scope(function(){var f=webfont.FontWatcher,u=webfont.FontWatchRunner,d=webfont.NativeFontWatchRunner;f.SHOULD_USE_NATIVE_LOADER=null;f.getUserAgent=function(){return window.navigator.userAgent};f.getVendor=function(){return window.navigator.vendor};f.shouldUseNativeLoader=function(){if(f.SHOULD_USE_NATIVE_LOADER===null){if(!!window.FontFace){var t=/Gecko.*Firefox\/(\d+)/.exec(f.getUserAgent());var e=/OS X.*Version\/10\..*Safari/.exec(f.getUserAgent())&&/Apple/.exec(f.getVendor());if(t){f.SHOULD_USE_NATIVE_LOADER=parseInt(t[1],10)>42}else if(e){f.SHOULD_USE_NATIVE_LOADER=false}else{f.SHOULD_USE_NATIVE_LOADER=true}}else{f.SHOULD_USE_NATIVE_LOADER=false}}return f.SHOULD_USE_NATIVE_LOADER};f.prototype.watchFonts=function(t,e,n,i){var o=t.length,s=e||{};if(o===0&&i){this.eventDispatcher_.dispatchInactive();return}this.currentlyWatched_+=t.length;if(i){this.last_=i}var r,a=[];for(r=0;r<t.length;r++){var h=t[r],c=s[h.getName()];this.eventDispatcher_.dispatchFontLoading(h);var _=null;if(f.shouldUseNativeLoader()){_=new d(goog.bind(this.fontActive_,this),goog.bind(this.fontInactive_,this),this.domHelper_,h,this.timeout_,c)}else{_=new u(goog.bind(this.fontActive_,this),goog.bind(this.fontInactive_,this),this.domHelper_,h,this.timeout_,n,c)}a.push(_)}for(r=0;r<a.length;r++){a[r].start()}};f.prototype.fontActive_=function(t){this.eventDispatcher_.dispatchFontActive(t);this.success_=true;this.decreaseCurrentlyWatched_()};f.prototype.fontInactive_=function(t){this.eventDispatcher_.dispatchFontInactive(t);this.decreaseCurrentlyWatched_()};f.prototype.decreaseCurrentlyWatched_=function(){if(--this.currentlyWatched_==0&&this.last_){if(this.success_){this.eventDispatcher_.dispatchActive()}else{this.eventDispatcher_.dispatchInactive()}}}});