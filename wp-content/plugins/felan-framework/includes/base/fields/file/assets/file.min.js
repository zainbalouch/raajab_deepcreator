var GLF_FileClass=function(e){this.$container=e};(function(u){"use strict";GLF_FileClass.prototype={init:function(){this.select();this.remove();this.sortable()},select:function(){var c=this,e=c.$container.find(".glf-file-add > button"),i=c.$container.data("lib-filter"),l={title:sfFileFieldMeta.title,button:sfFileFieldMeta.button},r=new GLFMedia;if(typeof i!="undefined"&&i!=null&&i!=""){l.filter=i}r.selectGallery(e,l,function(e){if(e.length){var i=u(r.clickedButton),l=c.$container.find('input[type="hidden"]'),t=l.val(),n=t.split("|"),a="",f=c.$container.data("remove-text");e.each(function(e){e=e.toJSON();if(n.indexOf(""+e.id)!=-1){return}if(t!=""){t+="|"+e.id}else{t=""+e.id}n.push(""+e.id);a+='<div class="glf-file-item" data-file-id="'+e.id+'">';a+='<span class="dashicons dashicons-media-document"></span>';a+='<div class="glf-file-info">';a+='<a class="glf-file-title" href="'+e.editLink+'" target="_blank">'+e.title+"</a>";a+='<div class="glf-file-name">'+e.filename+"</div>";a+='<div class="glf-file-action">';a+='<span class="glf-file-remove"><span class="dashicons dashicons-no-alt"></span> '+f+"</span>";a+="</div>";a+="</div>";a+="</div>"});l.val(t);var d=u(a);i.parent().before(d);c.remove(d);var s=i.closest(".glf-field"),o=GLFFieldsConfig.fields.getValue(s);GLFFieldsConfig.required.checkRequired(s,o)}})},remove:function(e){if(typeof e==="undefined"){e=this.$container}e.find(".glf-file-remove").on("click",function(){var e=u(this).closest(".glf-file-item");var i=e.parent();var l=i.find('input[type="hidden"]');e.remove();var t="";u(".glf-file-item",i).each(function(){if(t!=""){t+="|"+u(this).data("file-id")}else{t=""+u(this).data("file-id")}});l.val(t);var n=i.closest(".glf-field"),a=GLFFieldsConfig.fields.getValue(n);GLFFieldsConfig.required.checkRequired(n,a)})},sortable:function(){this.$container.sortable({placeholder:"glf-file-sortable-placeholder",items:".glf-file-item",handle:".dashicons-media-document",update:function(e,i){var l=u(e.target);var t="";u(".glf-file-item",l).each(function(){if(t!=""){t+="|"+u(this).data("file-id")}else{t=""+u(this).data("file-id")}});var n=l.find('input[type="hidden"]');n.val(t);var a=l.closest(".glf-field"),f=GLFFieldsConfig.fields.getValue(a);GLFFieldsConfig.required.checkRequired(a,f)}})}};var e={init:function(){var e=u(".glf-meta-config-wrapper");e=e.length?e:u("body");e.on("glf_make_template_done",function(){u(".glf-field-file-inner").each(function(){var e=new GLF_FileClass(u(this));e.init()})});u(".glf-field.glf-field-file").on("glf_add_clone_field",function(e){var i=u(e.target).find(".glf-field-file-inner");if(i.length){var l=new GLF_FileClass(i);l.init()}})}};u(document).ready(function(){e.init();GLFFieldsConfig.fieldInstance.push(e)})})(jQuery);