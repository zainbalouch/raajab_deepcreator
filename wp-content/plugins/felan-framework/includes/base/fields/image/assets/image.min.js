var GLF_ImageClass=function(e){this.$container=e};(function(r){"use strict";GLF_ImageClass.prototype={init:function(){this.selectMedia()},selectMedia:function(){var a=this,n=a.$container.find(".glf-image-id"),t=a.$container.find(".glf-image-url"),e=a.$container.find(".glf-image-choose-image"),i=a.$container.find(".glf-image-remove"),l=a.$container.find(".glf-image-preview img"),f=a.$container.find(".glf-image-choose-image-dir");if(f.length){r.ajax({url:glfMetaData.ajax_url,data:{action:"glf_select_default_image"},success:function(e){var i=r(".glf-image-default-popup");if(i.length==0){i=r(e);r("body").append(i);a.imageDefaultPopupEvent(i)}}})}f.on("click",function(){var e=r(".glf-image-default-popup");if(!e.length){return}e.data("urlField",t);e.data("idField",n);e.data("previewField",l);e.show()});var c=new GLFMedia;c.selectImage(e,{filter:"image"},function(e){if(e){var i="";if(e.sizes.thumbnail==undefined){if(e=="svg"){i=e.url}else{i=e.sizes.full.url}}else{i=e.sizes.thumbnail.url}l.attr("src",i);l.show();n.val(e.id);t.val(e.url);a.changeField(a.$container)}});i.on("click",function(){l.attr("src","");l.hide();n.val("");t.val("");a.changeField(a.$container)});t.on("change",function(){r.ajax({url:glfMetaData.ajax_url,data:{action:"glf_get_attachment_id",url:t.val()},type:"GET",error:function(){n.val("0")},success:function(e){n.val(e)}});if(t.val()==""){l.attr("src","");l.hide()}else{l.attr("src",t.val());l.show()}})},imageDefaultPopupEvent:function(a){var n=this;a.find(".glf-image-default-popup-content > h1 > span").on("click",function(){a.hide()});a.find(".glf-image-default-popup-item").on("click",function(){var e=r(this).find("img"),i=e.attr("src");a.data("previewField").attr("src",i);a.data("previewField").show();a.data("idField").val("0");a.data("urlField").val(i);a.hide();n.changeField(n.$container)})},changeField:function(e){var i=e.closest(".glf-field"),a=GLFFieldsConfig.fields.getValue(i);GLFFieldsConfig.required.checkRequired(i,a)}};var e={init:function(){var e=r(".glf-meta-config-wrapper");e=e.length?e:r("body");e.on("glf_make_template_done",function(){r(".glf-field-image-inner").each(function(){var e=new GLF_ImageClass(r(this));e.init()})});r(".glf-field.glf-field-image").on("glf_add_clone_field",function(e){var i=r(e.target).find(".glf-field-image-inner");if(i.length){console.log(i);var a=new GLF_ImageClass(i);a.init()}})}};r(document).ready(function(){e.init();GLFFieldsConfig.fieldInstance.push(e)})})(jQuery);