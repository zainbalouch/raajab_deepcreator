(function(e,t){if(typeof define==="function"&&define.amd){define("sifter",t)}else if(typeof exports==="object"){module.exports=t()}else{e.Sifter=t()}})(this,function(){var e=function(e,t){this.items=e;this.settings=t||{diacritics:true}};e.prototype.tokenize=function(e){e=a(String(e||"").toLowerCase());if(!e||!e.length)return[];var t,i,n,r;var o=[];var s=e.split(/ +/);for(t=0,i=s.length;t<i;t++){n=l(s[t]);if(this.settings.diacritics){for(r in u){if(u.hasOwnProperty(r)){n=n.replace(new RegExp(r,"g"),u[r])}}}o.push({string:s[t],regex:new RegExp(n,"i")})}return o};e.prototype.iterator=function(e,t){var i;if(s(e)){i=Array.prototype.forEach||function(e){for(var t=0,i=this.length;t<i;t++){e(this[t],t,this)}}}else{i=function(e){for(var t in this){if(this.hasOwnProperty(t)){e(this[t],t,this)}}}}i.apply(e,[t])};e.prototype.getScoreFunction=function(e,t){var i,o,r,s,a;i=this;e=i.prepareSearch(e,t);r=e.tokens;o=e.options.fields;s=r.length;a=e.options.nesting;var l=function(e,t){var i,n;if(!e)return 0;e=String(e||"");n=e.search(t.regex);if(n===-1)return 0;i=t.string.length/e.length;if(n===0)i+=.5;return i};var u=function(){var r=o.length;if(!r){return function(){return 0}}if(r===1){return function(e,t){return l(h(t,o[0],a),e)}}return function(e,t){for(var i=0,n=0;i<r;i++){n+=l(h(t,o[i],a),e)}return n/r}}();if(!s){return function(){return 0}}if(s===1){return function(e){return u(r[0],e)}}if(e.options.conjunction==="and"){return function(e){var t;for(var i=0,n=0;i<s;i++){t=u(r[i],e);if(t<=0)return 0;n+=t}return n/s}}else{return function(e){for(var t=0,i=0;t<s;t++){i+=u(r[t],e)}return i/s}}};e.prototype.getSortFunction=function(e,i){var t,n,r,o,a,l,s,u,p,c,f;r=this;e=r.prepareSearch(e,i);f=!e.query&&i.sort_empty||i.sort;p=function(e,t){if(e==="$score")return t.score;return h(r.items[t.id],e,i.nesting)};a=[];if(f){for(t=0,n=f.length;t<n;t++){if(e.query||f[t].field!=="$score"){a.push(f[t])}}}if(e.query){c=true;for(t=0,n=a.length;t<n;t++){if(a[t].field==="$score"){c=false;break}}if(c){a.unshift({field:"$score",direction:"desc"})}}else{for(t=0,n=a.length;t<n;t++){if(a[t].field==="$score"){a.splice(t,1);break}}}u=[];for(t=0,n=a.length;t<n;t++){u.push(a[t].direction==="desc"?-1:1)}l=a.length;if(!l){return null}else if(l===1){o=a[0].field;s=u[0];return function(e,t){return s*d(p(o,e),p(o,t))}}else{return function(e,t){var i,n,r,o,s;for(i=0;i<l;i++){s=a[i].field;n=u[i]*d(p(s,e),p(s,t));if(n)return n}return 0}}};e.prototype.prepareSearch=function(e,t){if(typeof e==="object")return e;t=o({},t);var i=t.fields;var n=t.sort;var r=t.sort_empty;if(i&&!s(i))t.fields=[i];if(n&&!s(n))t.sort=[n];if(r&&!s(r))t.sort_empty=[r];return{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}};e.prototype.search=function(e,i){var t=this,n,r,o,s;var a;var l;o=this.prepareSearch(e,i);i=o.options;e=o.query;l=i.score||t.getScoreFunction(o);if(e.length){t.iterator(t.items,function(e,t){r=l(e);if(i.filter===false||r>0){o.items.push({score:r,id:t})}})}else{t.iterator(t.items,function(e,t){o.items.push({score:1,id:t})})}a=t.getSortFunction(o,i);if(a)o.items.sort(a);o.total=o.items.length;if(typeof i.limit==="number"){o.items=o.items.slice(0,i.limit)}return o};var d=function(e,t){if(typeof e==="number"&&typeof t==="number"){return e>t?1:e<t?-1:0}e=i(String(e||""));t=i(String(t||""));if(e>t)return 1;if(t>e)return-1;return 0};var o=function(e,t){var i,n,r,o;for(i=1,n=arguments.length;i<n;i++){o=arguments[i];if(!o)continue;for(r in o){if(o.hasOwnProperty(r)){e[r]=o[r]}}}return e};var h=function(e,t,i){if(!e||!t)return;if(!i)return e[t];var n=t.split(".");while(n.length&&(e=e[n.shift()]));return e};var a=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")};var l=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var s=Array.isArray||typeof $!=="undefined"&&$.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};var u={a:"[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇŽÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]",b:"[bâ¢Î²Î’Bà¸¿ðŒá›’]",c:"[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]",d:"[dÄŽÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸Žá¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]",e:"[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]",f:"[fÆ‘Æ’á¸žá¸Ÿ]",g:"[gÉ¢â‚²Ç¤Ç¥ÄœÄÄžÄŸÄ¢Ä£Æ“É Ä Ä¡]",h:"[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]",i:"[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃŽÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]",j:"[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]",k:"[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]",l:"[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]",n:"[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æžáµ°á¶‡É³ÈµÉ´ï¼®ï½ŽÅŠÅ‹]",o:"[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅŽÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»Žá»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]",p:"[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]",q:"[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]",r:"[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]",s:"[sÅšÅ›á¹ á¹¡á¹¢á¹£êž¨êž©ÅœÅÅ Å¡ÅžÅŸÈ˜È™SÌˆsÌˆ]",t:"[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]",u:"[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]",v:"[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êžêŸâ±±Ê‹]",w:"[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]",x:"[xáºŒáºáºŠáº‹Ï‡]",y:"[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºŽáºá»´á»µÉŽÉÆ³Æ´]",z:"[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]"};var i=function(){var e,t,i,n;var r="";var o={};for(i in u){if(u.hasOwnProperty(i)){n=u[i].substring(2,u[i].length-1);r+=n;for(e=0,t=n.length;e<t;e++){o[n.charAt(e)]=i}}}var s=new RegExp("["+r+"]","g");return function(e){return e.replace(s,function(e){return o[e]}).toLowerCase()}}();return e});(function(e,t){if(typeof define==="function"&&define.amd){define("microplugin",t)}else if(typeof exports==="object"){module.exports=t()}else{e.MicroPlugin=t()}})(this,function(){var e={};e.mixin=function(r){r.plugins={};r.prototype.initializePlugins=function(e){var t,i,n;var r=this;var o=[];r.plugins={names:[],settings:{},requested:{},loaded:{}};if(s.isArray(e)){for(t=0,i=e.length;t<i;t++){if(typeof e[t]==="string"){o.push(e[t])}else{r.plugins.settings[e[t].name]=e[t].options;o.push(e[t].name)}}}else if(e){for(n in e){if(e.hasOwnProperty(n)){r.plugins.settings[n]=e[n];o.push(n)}}}while(o.length){r.require(o.shift())}};r.prototype.loadPlugin=function(e){var t=this;var i=t.plugins;var n=r.plugins[e];if(!r.plugins.hasOwnProperty(e)){throw new Error('Unable to find "'+e+'" plugin')}i.requested[e]=true;i.loaded[e]=n.fn.apply(t,[t.plugins.settings[e]||{}]);i.names.push(e)};r.prototype.require=function(e){var t=this;var i=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(i.requested[e]){throw new Error('Plugin has circular dependency ("'+e+'")')}t.loadPlugin(e)}return i.loaded[e]};r.define=function(e,t){r.plugins[e]={name:e,fn:t}}};var s={isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}};return e});(function(e,t){if(typeof define==="function"&&define.amd){define("selectize",["jquery","sifter","microplugin"],t)}else if(typeof exports==="object"){module.exports=t(require("jquery"),require("sifter"),require("microplugin"))}else{e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}})(this,function(C,u,e){"use strict";var b=function(e,t){if(typeof t==="string"&&!t.length)return;var u=typeof t==="string"?new RegExp(t,"i"):t;var p=function(e){var t=0;if(e.nodeType===3){var i=e.data.search(u);if(i>=0&&e.data.length>0){var n=e.data.match(u);var r=document.createElement("span");r.className="highlight";var o=e.splitText(i);var s=o.splitText(n[0].length);var a=o.cloneNode(true);r.appendChild(a);o.parentNode.replaceChild(r,o);t=1}}else if(e.nodeType===1&&e.childNodes&&!/(script|style)/i.test(e.tagName)){for(var l=0;l<e.childNodes.length;++l){l+=p(e.childNodes[l])}}return t};return e.each(function(){p(this)})};jQuery.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var e=this.parentNode;e.replaceChild(this.firstChild,this);e.normalize()}).end()};var n=function(){};n.prototype={on:function(e,t){this._events=this._events||{};this._events[e]=this._events[e]||[];this._events[e].push(t)},off:function(e,t){var i=arguments.length;if(i===0)return delete this._events;if(i===1)return delete this._events[e];this._events=this._events||{};if(e in this._events===false)return;this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){this._events=this._events||{};if(e in this._events===false)return;for(var t=0;t<this._events[e].length;t++){this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}}};n.mixin=function(e){var t=["on","off","trigger"];for(var i=0;i<t.length;i++){e.prototype[t[i]]=n.prototype[t[i]]}};var w=/Mac/.test(navigator.userAgent);var o=65;var i=188;var s=13;var a=27;var p=37;var l=38;var c=80;var f=39;var d=40;var h=78;var g=8;var v=46;var O=16;var $=w?91:17;var x=w?18:17;var m=9;var S=1;var y=2;var I=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity;var _=function(e){return typeof e!=="undefined"};var F=function(e){if(typeof e==="undefined"||e===null)return null;if(typeof e==="boolean")return e?"1":"0";return e+""};var D=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var N=function(e){return(e+"").replace(/\$/g,"$$$$")};var t={};t.before=function(e,t,i){var n=e[t];e[t]=function(){i.apply(e,arguments);return n.apply(e,arguments)}};t.after=function(t,e,i){var n=t[e];t[e]=function(){var e=n.apply(t,arguments);i.apply(t,arguments);return e}};var k=function(e){var t=false;return function(){if(t)return;t=true;e.apply(this,arguments)}};var A=function(i,n){var r;return function(){var e=this;var t=arguments;window.clearTimeout(r);r=window.setTimeout(function(){i.apply(e,t)},n)}};var r=function(t,i,e){var n;var r=t.trigger;var o={};t.trigger=function(){var e=arguments[0];if(i.indexOf(e)!==-1){o[e]=arguments}else{return r.apply(t,arguments)}};e.apply(t,[]);t.trigger=r;for(n in o){if(o.hasOwnProperty(n)){r.apply(t,o[n])}}};var P=function(i,e,t,n){i.on(e,t,function(e){var t=e.target;while(t&&t.parentNode!==i[0]){t=t.parentNode}e.currentTarget=t;return n.apply(this,[e])})};var z=function(e){var t={};if("selectionStart"in e){t.start=e.selectionStart;t.length=e.selectionEnd-t.start}else if(document.selection){e.focus();var i=document.selection.createRange();var n=document.selection.createRange().text.length;i.moveStart("character",-e.value.length);t.start=i.text.length-n;t.length=n}return t};var T=function(e,t,i){var n,r,o={};if(i){for(n=0,r=i.length;n<r;n++){o[i[n]]=e.css(i[n])}}else{o=e.css()}t.css(o)};var q=function(e,t){if(!e){return 0}var i=C("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(e).appendTo("body");T(t,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var n=i.width();i.remove();return n};var E=function(p){var c=null;var e=function(e,t){var i,n,r,o,s;var a,l,u;e=e||window.event||{};t=t||{};if(e.metaKey||e.altKey)return;if(!t.force&&p.data("grow")===false)return;i=p.val();if(e.type&&e.type.toLowerCase()==="keydown"){n=e.keyCode;r=n>=97&&n<=122||n>=65&&n<=90||n>=48&&n<=57||n===32;if(n===v||n===g){u=z(p[0]);if(u.length){i=i.substring(0,u.start)+i.substring(u.start+u.length)}else if(n===g&&u.start){i=i.substring(0,u.start-1)+i.substring(u.start+1)}else if(n===v&&typeof u.start!=="undefined"){i=i.substring(0,u.start)+i.substring(u.start+1)}}else if(r){a=e.shiftKey;l=String.fromCharCode(e.keyCode);if(a)l=l.toUpperCase();else l=l.toLowerCase();i+=l}}o=p.attr("placeholder");if(!i&&o){i=o}s=q(i,p)+4;if(s!==c){c=s;p.width(s);p.triggerHandler("resize")}};p.on("keydown keyup update blur",e);e()};var H=function(e){var t=document.createElement("div");t.appendChild(e.cloneNode(true));return t.innerHTML};var L=function(e,t){if(!t)t={};var i="Selectize";console.error(i+": "+e);if(t.explanation){if(console.group)console.group();console.error(t.explanation);if(console.group)console.groupEnd()}};var j=function(e,t){var i,n,r,o,s,a=this;s=e[0];s.selectize=a;var l=window.getComputedStyle&&window.getComputedStyle(s,null);o=l?l.getPropertyValue("direction"):s.currentStyle&&s.currentStyle.direction;o=o||e.parents("[dir]:first").attr("dir")||"";C.extend(a,{order:0,settings:t,$input:e,tabIndex:e.attr("tabindex")||"",tagType:s.tagName.toLowerCase()==="select"?S:y,rtl:/rtl/i.test(o),eventNS:".selectize"+ ++j.count,highlightedValue:null,isOpen:false,isDisabled:false,isRequired:e.is("[required]"),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreBlur:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:t.loadThrottle===null?a.onSearchChange:A(a.onSearchChange,t.loadThrottle)});a.sifter=new u(this.options,{diacritics:t.diacritics});if(a.settings.options){for(n=0,r=a.settings.options.length;n<r;n++){a.registerOption(a.settings.options[n])}delete a.settings.options}if(a.settings.optgroups){for(n=0,r=a.settings.optgroups.length;n<r;n++){a.registerOptionGroup(a.settings.optgroups[n])}delete a.settings.optgroups}a.settings.mode=a.settings.mode||(a.settings.maxItems===1?"single":"multi");if(typeof a.settings.hideSelected!=="boolean"){a.settings.hideSelected=a.settings.mode==="multi"}a.initializePlugins(a.settings.plugins);a.setupCallbacks();a.setupTemplates();a.setup()};n.mixin(j);if(typeof e!=="undefined"){e.mixin(j)}else{L("Dependency MicroPlugin is missing",{explanation:'Make sure you either: (1) are using the "standalone" '+"version of Selectize, or (2) require MicroPlugin before you "+"load Selectize."})}C.extend(j.prototype,{setup:function(){var t=this;var e=t.settings;var i=t.eventNS;var n=C(window);var r=C(document);var o=t.$input;var s;var a;var l;var u;var p;var c;var f;var d;var h;var g;var v;var m;f=t.settings.mode;g=o.attr("class")||"";s=C("<div>").addClass(e.wrapperClass).addClass(g).addClass(f);a=C("<div>").addClass(e.inputClass).addClass("items").appendTo(s);l=C('<input type="text" autocomplete="off" />').appendTo(a).attr("tabindex",o.is(":disabled")?"-1":t.tabIndex);c=C(e.dropdownParent||s);u=C("<div>").addClass(e.dropdownClass).addClass(f).hide().appendTo(c);p=C("<div>").addClass(e.dropdownContentClass).appendTo(u);if(m=o.attr("id")){l.attr("id",m+"-selectized");C("label[for='"+m+"']").attr("for",m+"-selectized")}if(t.settings.copyClassesToDropdown){u.addClass(g)}s.css({width:o[0].style.width});if(t.plugins.names.length){v="plugin-"+t.plugins.names.join(" plugin-");s.addClass(v);u.addClass(v)}if((e.maxItems===null||e.maxItems>1)&&t.tagType===S){o.attr("multiple","multiple")}if(t.settings.placeholder){l.attr("placeholder",e.placeholder)}if(!t.settings.splitOn&&t.settings.delimiter){var y=t.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");t.settings.splitOn=new RegExp("\\s*"+y+"+\\s*")}if(o.attr("autocorrect")){l.attr("autocorrect",o.attr("autocorrect"))}if(o.attr("autocapitalize")){l.attr("autocapitalize",o.attr("autocapitalize"))}t.$wrapper=s;t.$control=a;t.$control_input=l;t.$dropdown=u;t.$dropdown_content=p;u.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)});u.on("mousedown click","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)});P(a,"mousedown","*:not(input)",function(){return t.onItemSelect.apply(t,arguments)});E(l);a.on({mousedown:function(){return t.onMouseDown.apply(t,arguments)},click:function(){return t.onClick.apply(t,arguments)}});l.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){t.ignoreBlur=false;return t.onFocus.apply(t,arguments)},paste:function(){return t.onPaste.apply(t,arguments)}});r.on("keydown"+i,function(e){t.isCmdDown=e[w?"metaKey":"ctrlKey"];t.isCtrlDown=e[w?"altKey":"ctrlKey"];t.isShiftDown=e.shiftKey});r.on("keyup"+i,function(e){if(e.keyCode===x)t.isCtrlDown=false;if(e.keyCode===O)t.isShiftDown=false;if(e.keyCode===$)t.isCmdDown=false});r.on("mousedown"+i,function(e){if(t.isFocused){if(e.target===t.$dropdown[0]||e.target.parentNode===t.$dropdown[0]){return false}if(!t.$control.has(e.target).length&&e.target!==t.$control[0]){t.blur(e.target)}}});n.on(["scroll"+i,"resize"+i].join(" "),function(){if(t.isOpen){t.positionDropdown.apply(t,arguments)}});n.on("mousemove"+i,function(){t.ignoreHover=false});this.revertSettings={$children:o.children().detach(),tabindex:o.attr("tabindex")};o.attr("tabindex",-1).hide().after(t.$wrapper);if(C.isArray(e.items)){t.setValue(e.items);delete e.items}if(I){o.on("invalid"+i,function(e){e.preventDefault();t.isInvalid=true;t.refreshState()})}t.updateOriginalInput();t.refreshItems();t.refreshState();t.updatePlaceholder();t.isSetup=true;if(o.is(":disabled")){t.disable()}t.on("change",this.onChange);o.data("selectize",t);o.addClass("selectized");t.trigger("initialize");if(e.preload===true){t.onSearchChange("")}},setupTemplates:function(){var e=this;var i=e.settings.labelField;var n=e.settings.optgroupLabelField;var t={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[n])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[i])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[i])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};e.settings.render=C.extend({},t,e.settings.render)},setupCallbacks:function(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i){if(i.hasOwnProperty(e)){t=this.settings[i[e]];if(t)this.on(e,t)}}},onClick:function(e){var t=this;if(!t.isFocused){t.focus();e.preventDefault()}},onMouseDown:function(e){var t=this;var i=e.isDefaultPrevented();var n=C(e.target);if(t.isFocused){if(e.target!==t.$control_input[0]){if(t.settings.mode==="single"){t.isOpen?t.close():t.open()}else if(!i){t.setActiveItem(null)}return false}}else{if(!i){window.setTimeout(function(){t.focus()},0)}}},onChange:function(){this.$input.trigger("change")},onPaste:function(e){var r=this;if(r.isFull()||r.isInputHidden||r.isLocked){e.preventDefault();return}if(r.settings.splitOn){setTimeout(function(){var e=r.$control_input.val();if(!e.match(r.settings.splitOn)){return}var t=C.trim(e).split(r.settings.splitOn);for(var i=0,n=t.length;i<n;i++){r.createItem(t[i])}},0)}},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);if(this.settings.create&&this.settings.mode==="multi"&&t===this.settings.delimiter){this.createItem();e.preventDefault();return false}},onKeyDown:function(e){var t=e.target===this.$control_input[0];var i=this;if(i.isLocked){if(e.keyCode!==m){e.preventDefault()}return}switch(e.keyCode){case o:if(i.isCmdDown){i.selectAll();return}break;case a:if(i.isOpen){e.preventDefault();e.stopPropagation();i.close()}return;case h:if(!e.ctrlKey||e.altKey)break;case d:if(!i.isOpen&&i.hasOptions){i.open()}else if(i.$activeOption){i.ignoreHover=true;var n=i.getAdjacentOption(i.$activeOption,1);if(n.length)i.setActiveOption(n,true,true)}e.preventDefault();return;case c:if(!e.ctrlKey||e.altKey)break;case l:if(i.$activeOption){i.ignoreHover=true;var r=i.getAdjacentOption(i.$activeOption,-1);if(r.length)i.setActiveOption(r,true,true)}e.preventDefault();return;case s:if(i.isOpen&&i.$activeOption){i.onOptionSelect({currentTarget:i.$activeOption});e.preventDefault()}return;case p:i.advanceSelection(-1,e);return;case f:i.advanceSelection(1,e);return;case m:if(i.settings.selectOnTab&&i.isOpen&&i.$activeOption){i.onOptionSelect({currentTarget:i.$activeOption});if(!i.isFull()){e.preventDefault()}}if(i.settings.create&&i.createItem()){e.preventDefault()}return;case g:case v:i.deleteSelection(e);return}if((i.isFull()||i.isInputHidden)&&!(w?e.metaKey:e.ctrlKey)){e.preventDefault();return}},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var i=t.$control_input.val()||"";if(t.lastValue!==i){t.lastValue=i;t.onSearchChange(i);t.refreshOptions();t.trigger("type",i)}},onSearchChange:function(t){var i=this;var n=i.settings.load;if(!n)return;if(i.loadedSearches.hasOwnProperty(t))return;i.loadedSearches[t]=true;i.load(function(e){n.apply(i,[t,e])})},onFocus:function(e){var t=this;var i=t.isFocused;if(t.isDisabled){t.blur();e&&e.preventDefault();return false}if(t.ignoreFocus)return;t.isFocused=true;if(t.settings.preload==="focus")t.onSearchChange("");if(!i)t.trigger("focus");if(!t.$activeItems.length){t.showInput();t.setActiveItem(null);t.refreshOptions(!!t.settings.openOnFocus)}t.refreshState()},onBlur:function(e,t){var i=this;if(!i.isFocused)return;i.isFocused=false;if(i.ignoreFocus){return}else if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0]){i.ignoreBlur=true;i.onFocus(e);return}var n=function(){i.close();i.setTextboxValue("");i.setActiveItem(null);i.setActiveOption(null);i.setCaret(i.items.length);i.refreshState();t&&t.focus();i.ignoreFocus=false;i.trigger("blur")};i.ignoreFocus=true;if(i.settings.create&&i.settings.createOnBlur){i.createItem(null,false,n)}else{n()}},onOptionHover:function(e){if(this.ignoreHover)return;this.setActiveOption(e.currentTarget,false)},onOptionSelect:function(e){var t,i,n,r=this;if(e.preventDefault){e.preventDefault();e.stopPropagation()}i=C(e.currentTarget);if(i.hasClass("create")){r.createItem(null,function(){if(r.settings.closeAfterSelect){r.close()}})}else{t=i.attr("data-value");if(typeof t!=="undefined"){r.lastQuery=null;r.setTextboxValue("");r.addItem(t);if(r.settings.closeAfterSelect){r.close()}else if(!r.settings.hideSelected&&e.type&&/mouse/.test(e.type)){r.setActiveOption(r.getOption(t))}}}},onItemSelect:function(e){var t=this;if(t.isLocked)return;if(t.settings.mode==="multi"){e.preventDefault();t.setActiveItem(e.currentTarget,e)}},load:function(e){var t=this;var i=t.$wrapper.addClass(t.settings.loadingClass);t.loading++;e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0);if(e&&e.length){t.addOption(e);t.refreshOptions(t.isFocused&&!t.isInputHidden)}if(!t.loading){i.removeClass(t.settings.loadingClass)}t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input;var i=t.val()!==e;if(i){t.val(e).triggerHandler("update");this.lastValue=e}},getValue:function(){if(this.tagType===S&&this.$input.attr("multiple")){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(e,t){var i=t?[]:["change"];r(this,i,function(){this.clear(t);this.addItems(e,t)})},setActiveItem:function(e,t){var i=this;var n;var r,o,s,a,l,u;var p;if(i.settings.mode==="single")return;e=C(e);if(!e.length){C(i.$activeItems).removeClass("active");i.$activeItems=[];if(i.isFocused){i.showInput()}return}n=t&&t.type.toLowerCase();if(n==="mousedown"&&i.isShiftDown&&i.$activeItems.length){p=i.$control.children(".active:last");s=Array.prototype.indexOf.apply(i.$control[0].childNodes,[p[0]]);a=Array.prototype.indexOf.apply(i.$control[0].childNodes,[e[0]]);if(s>a){u=s;s=a;a=u}for(r=s;r<=a;r++){l=i.$control[0].childNodes[r];if(i.$activeItems.indexOf(l)===-1){C(l).addClass("active");i.$activeItems.push(l)}}t.preventDefault()}else if(n==="mousedown"&&i.isCtrlDown||n==="keydown"&&this.isShiftDown){if(e.hasClass("active")){o=i.$activeItems.indexOf(e[0]);i.$activeItems.splice(o,1);e.removeClass("active")}else{i.$activeItems.push(e.addClass("active")[0])}}else{C(i.$activeItems).removeClass("active");i.$activeItems=[e.addClass("active")[0]]}i.hideInput();if(!this.isFocused){i.focus()}},setActiveOption:function(e,t,i){var n,r,o;var s,a;var l=this;if(l.$activeOption)l.$activeOption.removeClass("active");l.$activeOption=null;e=C(e);if(!e.length)return;l.$activeOption=e.addClass("active");if(t||!_(t)){n=l.$dropdown_content.height();r=l.$activeOption.outerHeight(true);t=l.$dropdown_content.scrollTop()||0;o=l.$activeOption.offset().top-l.$dropdown_content.offset().top+t;s=o;a=o-n+r;if(o+r>n+t){l.$dropdown_content.stop().animate({scrollTop:a},i?l.settings.scrollDuration:0)}else if(o<t){l.$dropdown_content.stop().animate({scrollTop:s},i?l.settings.scrollDuration:0)}}},selectAll:function(){var e=this;if(e.settings.mode==="single")return;e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active"));if(e.$activeItems.length){e.hideInput();e.close()}e.focus()},hideInput:function(){var e=this;e.setTextboxValue("");e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4});e.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=false},focus:function(){var e=this;if(e.isDisabled)return;e.ignoreFocus=true;e.$control_input[0].focus();window.setTimeout(function(){e.ignoreFocus=false;e.onFocus()},0)},blur:function(e){this.$control_input[0].blur();this.onBlur(null,e)},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings;var t=e.sortField;if(typeof t==="string"){t=[{field:t}]}return{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(e){var t,i,n,r,o;var s=this;var a=s.settings;var l=this.getSearchOptions();if(a.score){o=s.settings.score.apply(this,[e]);if(typeof o!=="function"){throw new Error('Selectize "score" setting must be a function that returns a function')}}if(e!==s.lastQuery){s.lastQuery=e;r=s.sifter.search(e,C.extend(l,{score:o}));s.currentResults=r}else{r=C.extend(true,{},s.currentResults)}if(a.hideSelected){for(t=r.items.length-1;t>=0;t--){if(s.items.indexOf(F(r.items[t].id))!==-1){r.items.splice(t,1)}}}return r},refreshOptions:function(e){var t,i,n,r,o,s,a,l,u,p,c,f,d;var h,g,v;if(typeof e==="undefined"){e=true}var m=this;var y=C.trim(m.$control_input.val());var w=m.search(y);var O=m.$dropdown_content;var $=m.$activeOption&&F(m.$activeOption.attr("data-value"));r=w.items.length;if(typeof m.settings.maxOptions==="number"){r=Math.min(r,m.settings.maxOptions)}o={};s=[];for(t=0;t<r;t++){a=m.options[w.items[t].id];l=m.render("option",a);u=a[m.settings.optgroupField]||"";p=C.isArray(u)?u:[u];for(i=0,n=p&&p.length;i<n;i++){u=p[i];if(!m.optgroups.hasOwnProperty(u)){u=""}if(!o.hasOwnProperty(u)){o[u]=document.createDocumentFragment();s.push(u)}o[u].appendChild(l)}}if(this.settings.lockOptgroupOrder){s.sort(function(e,t){var i=m.optgroups[e].$order||0;var n=m.optgroups[t].$order||0;return i-n})}c=document.createDocumentFragment();for(t=0,r=s.length;t<r;t++){u=s[t];if(m.optgroups.hasOwnProperty(u)&&o[u].childNodes.length){f=document.createDocumentFragment();f.appendChild(m.render("optgroup_header",m.optgroups[u]));f.appendChild(o[u]);c.appendChild(m.render("optgroup",C.extend({},m.optgroups[u],{html:H(f),dom:f})))}else{c.appendChild(o[u])}}O.html(c);if(m.settings.highlight&&w.query.length&&w.tokens.length){O.removeHighlight();for(t=0,r=w.tokens.length;t<r;t++){b(O,w.tokens[t].regex)}}if(!m.settings.hideSelected){for(t=0,r=m.items.length;t<r;t++){m.getOption(m.items[t]).addClass("selected")}}d=m.canCreate(y);if(d){O.prepend(m.render("option_create",{input:y}));v=C(O[0].childNodes[0])}m.hasOptions=w.items.length>0||d;if(m.hasOptions){if(w.items.length>0){g=$&&m.getOption($);if(g&&g.length){h=g}else if(m.settings.mode==="single"&&m.items.length){h=m.getOption(m.items[0])}if(!h||!h.length){if(v&&!m.settings.addPrecedence){h=m.getAdjacentOption(v,1)}else{h=O.find("[data-selectable]:first")}}}else{h=v}m.setActiveOption(h);if(e&&!m.isOpen){m.open()}}else{m.setActiveOption(null);if(e&&m.isOpen){m.close()}}},addOption:function(e){var t,i,n,r=this;if(C.isArray(e)){for(t=0,i=e.length;t<i;t++){r.addOption(e[t])}return}if(n=r.registerOption(e)){r.userOptions[n]=true;r.lastQuery=null;r.trigger("option_add",n,e)}},registerOption:function(e){var t=F(e[this.settings.valueField]);if(typeof t==="undefined"||t===null||this.options.hasOwnProperty(t))return false;e.$order=e.$order||++this.order;this.options[t]=e;return t},registerOptionGroup:function(e){var t=F(e[this.settings.optgroupValueField]);if(!t)return false;e.$order=e.$order||++this.order;this.optgroups[t]=e;return t},addOptionGroup:function(e,t){t[this.settings.optgroupValueField]=e;if(e=this.registerOptionGroup(t)){this.trigger("optgroup_add",e,t)}},removeOptionGroup:function(e){if(this.optgroups.hasOwnProperty(e)){delete this.optgroups[e];this.renderCache={};this.trigger("optgroup_remove",e)}},clearOptionGroups:function(){this.optgroups={};this.renderCache={};this.trigger("optgroup_clear")},updateOption:function(e,t){var i=this;var n,r;var o,s,a,l,u;e=F(e);o=F(t[i.settings.valueField]);if(e===null)return;if(!i.options.hasOwnProperty(e))return;if(typeof o!=="string")throw new Error("Value must be set in option data");u=i.options[e].$order;if(o!==e){delete i.options[e];s=i.items.indexOf(e);if(s!==-1){i.items.splice(s,1,o)}}t.$order=t.$order||u;i.options[o]=t;a=i.renderCache["item"];l=i.renderCache["option"];if(a){delete a[e];delete a[o]}if(l){delete l[e];delete l[o]}if(i.items.indexOf(o)!==-1){n=i.getItem(e);r=C(i.render("item",t));if(n.hasClass("active"))r.addClass("active");n.replaceWith(r)}i.lastQuery=null;if(i.isOpen){i.refreshOptions(false)}},removeOption:function(e,t){var i=this;e=F(e);var n=i.renderCache["item"];var r=i.renderCache["option"];if(n)delete n[e];if(r)delete r[e];delete i.userOptions[e];delete i.options[e];i.lastQuery=null;i.trigger("option_remove",e);i.removeItem(e,t)},clearOptions:function(){var e=this;e.loadedSearches={};e.userOptions={};e.renderCache={};e.options=e.sifter.items={};e.lastQuery=null;e.trigger("option_clear");e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,t){var i=this.$dropdown.find("[data-selectable]");var n=i.index(e)+t;return n>=0&&n<i.length?i.eq(n):C()},getElementWithValue:function(e,t){e=F(e);if(typeof e!=="undefined"&&e!==null){for(var i=0,n=t.length;i<n;i++){if(t[i].getAttribute("data-value")===e){return C(t[i])}}}return C()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(e,t){var i=C.isArray(e)?e:[e];for(var n=0,r=i.length;n<r;n++){this.isPending=n<r-1;this.addItem(i[n],t)}},addItem:function(u,p){var e=p?[]:["change"];r(this,e,function(){var e,t,i;var n=this;var r=n.settings.mode;var o,s,a,l;u=F(u);if(n.items.indexOf(u)!==-1){if(r==="single")n.close();return}if(!n.options.hasOwnProperty(u))return;if(r==="single")n.clear(p);if(r==="multi"&&n.isFull())return;e=C(n.render("item",n.options[u]));l=n.isFull();n.items.splice(n.caretPos,0,u);n.insertAtCaret(e);if(!n.isPending||!l&&n.isFull()){n.refreshState()}if(n.isSetup){i=n.$dropdown_content.find("[data-selectable]");if(!n.isPending){t=n.getOption(u);a=n.getAdjacentOption(t,1).attr("data-value");n.refreshOptions(n.isFocused&&r!=="single");if(a){n.setActiveOption(n.getOption(a))}}if(!i.length||n.isFull()){n.close()}else{n.positionDropdown()}n.updatePlaceholder();n.trigger("item_add",u,e);n.updateOriginalInput({silent:p})}})},removeItem:function(e,t){var i=this;var n,r,o;n=e instanceof C?e:i.getItem(e);e=F(n.attr("data-value"));r=i.items.indexOf(e);if(r!==-1){n.remove();if(n.hasClass("active")){o=i.$activeItems.indexOf(n[0]);i.$activeItems.splice(o,1)}i.items.splice(r,1);i.lastQuery=null;if(!i.settings.persist&&i.userOptions.hasOwnProperty(e)){i.removeOption(e,t)}if(r<i.caretPos){i.setCaret(i.caretPos-1)}i.refreshState();i.updatePlaceholder();i.updateOriginalInput({silent:t});i.positionDropdown();i.trigger("item_remove",e,n)}},createItem:function(e,i){var n=this;var r=n.caretPos;e=e||C.trim(n.$control_input.val()||"");var o=arguments[arguments.length-1];if(typeof o!=="function")o=function(){};if(typeof i!=="boolean"){i=true}if(!n.canCreate(e)){o();return false}n.lock();var t=typeof n.settings.create==="function"?this.settings.create:function(e){var t={};t[n.settings.labelField]=e;t[n.settings.valueField]=e;return t};var s=k(function(e){n.unlock();if(!e||typeof e!=="object")return o();var t=F(e[n.settings.valueField]);if(typeof t!=="string")return o();n.setTextboxValue("");n.addOption(e);n.setCaret(r);n.addItem(t);n.refreshOptions(i&&n.settings.mode!=="single");o(e)});var a=t.apply(this,[e,s]);if(typeof a!=="undefined"){s(a)}return true},refreshItems:function(){this.lastQuery=null;if(this.isSetup){this.addItem(this.items)}this.refreshState();this.updateOriginalInput()},refreshState:function(){this.refreshValidityState();this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return false;var e=!this.items.length;this.isInvalid=e;this.$control_input.prop("required",e);this.$input.prop("required",!e)},refreshClasses:function(){var e=this;var t=e.isFull();var i=e.isLocked;e.$wrapper.toggleClass("rtl",e.rtl);e.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("required",e.isRequired).toggleClass("invalid",e.isInvalid).toggleClass("locked",i).toggleClass("full",t).toggleClass("not-full",!t).toggleClass("input-active",e.isFocused&&!e.isInputHidden).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!C.isEmptyObject(e.options)).toggleClass("has-items",e.items.length>0);e.$control_input.data("grow",!t&&!i)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(e){var t,i,n,r,o=this;e=e||{};if(o.tagType===S){n=[];for(t=0,i=o.items.length;t<i;t++){r=o.options[o.items[t]][o.settings.labelField]||"";n.push('<option value="'+D(o.items[t])+'" selected="selected">'+D(r)+"</option>")}if(!n.length&&!this.$input.attr("multiple")){n.push('<option value="" selected="selected"></option>')}o.$input.html(n.join(""))}else{o.$input.val(o.getValue());o.$input.attr("value",o.$input.val())}if(o.isSetup){if(!e.silent){o.trigger("change",o.$input.val())}}},updatePlaceholder:function(){if(!this.settings.placeholder)return;var e=this.$control_input;if(this.items.length){e.removeAttr("placeholder")}else{e.attr("placeholder",this.settings.placeholder)}e.triggerHandler("update",{force:true})},open:function(){var e=this;if(e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull())return;e.focus();e.isOpen=true;e.refreshState();e.$dropdown.css({visibility:"hidden",display:"block"});e.positionDropdown();e.$dropdown.css({visibility:"visible"});e.trigger("dropdown_open",e.$dropdown)},close:function(){var e=this;var t=e.isOpen;if(e.settings.mode==="single"&&e.items.length){e.hideInput();e.$control_input.blur()}e.isOpen=false;e.$dropdown.hide();e.setActiveOption(null);e.refreshState();if(t)e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control;var t=this.settings.dropdownParent==="body"?e.offset():e.position();t.top+=e.outerHeight(true)+1;this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(e){var t=this;if(!t.items.length)return;t.$control.children(":not(input)").remove();t.items=[];t.lastQuery=null;t.setCaret(0);t.setActiveItem(null);t.updatePlaceholder();t.updateOriginalInput({silent:e});t.refreshState();t.showInput();t.trigger("clear")},insertAtCaret:function(e){var t=Math.min(this.caretPos,this.items.length);if(t===0){this.$control.prepend(e)}else{C(this.$control[0].childNodes[t]).before(e)}this.setCaret(t+1)},deleteSelection:function(e){var t,i,n,r,o,s,a,l,u;var p=this;n=e&&e.keyCode===g?-1:1;r=z(p.$control_input[0]);if(p.$activeOption&&!p.settings.hideSelected){a=p.getAdjacentOption(p.$activeOption,-1).attr("data-value")}o=[];if(p.$activeItems.length){u=p.$control.children(".active:"+(n>0?"last":"first"));s=p.$control.children(":not(input)").index(u);if(n>0){s++}for(t=0,i=p.$activeItems.length;t<i;t++){o.push(C(p.$activeItems[t]).attr("data-value"))}if(e){e.preventDefault();e.stopPropagation()}}else if((p.isFocused||p.settings.mode==="single")&&p.items.length){if(n<0&&r.start===0&&r.length===0){o.push(p.items[p.caretPos-1])}else if(n>0&&r.start===p.$control_input.val().length){o.push(p.items[p.caretPos])}}if(!o.length||typeof p.settings.onDelete==="function"&&p.settings.onDelete.apply(p,[o])===false){return false}if(typeof s!=="undefined"){p.setCaret(s)}while(o.length){p.removeItem(o.pop())}p.showInput();p.positionDropdown();p.refreshOptions(true);if(a){l=p.getOption(a);if(l.length){p.setActiveOption(l)}}return true},advanceSelection:function(e,t){var i,n,r,o,s,a;var l=this;if(e===0)return;if(l.rtl)e*=-1;i=e>0?"last":"first";n=z(l.$control_input[0]);if(l.isFocused&&!l.isInputHidden){o=l.$control_input.val().length;s=e<0?n.start===0&&n.length===0:n.start===o;if(s&&!o){l.advanceCaret(e,t)}}else{a=l.$control.children(".active:"+i);if(a.length){r=l.$control.children(":not(input)").index(a);l.setActiveItem(null);l.setCaret(e>0?r+1:r)}}},advanceCaret:function(e,t){var i=this,n,r;if(e===0)return;n=e>0?"next":"prev";if(i.isShiftDown){r=i.$control_input[n]();if(r.length){i.hideInput();i.setActiveItem(r);t&&t.preventDefault()}}else{i.setCaret(i.caretPos+e)}},setCaret:function(e){var t=this;if(t.settings.mode==="single"){e=t.items.length}else{e=Math.max(0,Math.min(t.items.length,e))}if(!t.isPending){var i,n,r,o,s;o=t.$control.children(":not(input)");for(i=0,n=o.length;i<n;i++){s=C(o[i]).detach();if(i<e){t.$control_input.before(s)}else{t.$control.append(s)}}}t.caretPos=e},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",true);e.$control_input.prop("disabled",true).prop("tabindex",-1);e.isDisabled=true;e.lock()},enable:function(){var e=this;e.$input.prop("disabled",false);e.$control_input.prop("disabled",false).prop("tabindex",e.tabIndex);e.isDisabled=false;e.unlock()},destroy:function(){var e=this;var t=e.eventNS;var i=e.revertSettings;e.trigger("destroy");e.off();e.$wrapper.remove();e.$dropdown.remove();e.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show();e.$control_input.removeData("grow");e.$input.removeData("selectize");C(window).off(t);C(document).off(t);C(document.body).off(t);delete e.$input[0].selectize},render:function(e,t){var i,n,r;var o="";var s=false;var a=this;var l=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(e==="option"||e==="item"){i=F(t[a.settings.valueField]);s=!!i}if(s){if(!_(a.renderCache[e])){a.renderCache[e]={}}if(a.renderCache[e].hasOwnProperty(i)){return a.renderCache[e][i]}}o=C(a.settings.render[e].apply(this,[t,D]));if(e==="option"||e==="option_create"){o.attr("data-selectable","")}else if(e==="optgroup"){n=t[a.settings.optgroupValueField]||"";o.attr("data-group",n)}if(e==="option"||e==="item"){o.attr("data-value",i||"")}if(s){a.renderCache[e][i]=o[0]}return o[0]},clearCache:function(e){var t=this;if(typeof e==="undefined"){t.renderCache={}}else{delete t.renderCache[e]}},canCreate:function(e){var t=this;if(!t.settings.create)return false;var i=t.settings.createFilter;return e.length&&(typeof i!=="function"||i.apply(t,[e]))&&(typeof i!=="string"||new RegExp(i).test(e))&&(!(i instanceof RegExp)||i.test(e))}});j.count=0;j.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:true,diacritics:true,create:false,createOnBlur:false,createFilter:null,highlight:true,openOnFocus:true,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:false,selectOnTab:false,preload:false,allowEmptyOption:false,closeAfterSelect:false,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:false,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:true,render:{}};C.fn.selectize=function(o){var s=C.fn.selectize.defaults;var f=C.extend({},s,o);var d=f.dataAttr;var h=f.labelField;var g=f.valueField;var v=f.optgroupField;var m=f.optgroupLabelField;var y=f.optgroupValueField;var a=function(e,t){var i,n,r,o;var s=e.attr(d);if(!s){var a=C.trim(e.val()||"");if(!f.allowEmptyOption&&!a.length)return;r=a.split(f.delimiter);for(i=0,n=r.length;i<n;i++){o={};o[h]=r[i];o[g]=r[i];t.options.push(o)}t.items=r}else{t.options=JSON.parse(s);for(i=0,n=t.options.length;i<n;i++){t.items.push(t.options[i][g])}}};var l=function(e,s){var t,i,n,r,o=0;var a=s.options;var l={};var u=function(e){var t=d&&e.attr(d);if(typeof t==="string"&&t.length){return JSON.parse(t)}return null};var p=function(e,t){e=C(e);var i=F(e.val());if(!i&&!f.allowEmptyOption)return;if(l.hasOwnProperty(i)){if(t){var n=l[i][v];if(!n){l[i][v]=t}else if(!C.isArray(n)){l[i][v]=[n,t]}else{n.push(t)}}return}var r=u(e)||{};r[h]=r[h]||e.text();r[g]=r[g]||i;r[v]=r[v]||t;l[i]=r;a.push(r);if(e.is(":selected")){s.items.push(i)}};var c=function(e){var t,i,n,r,o;e=C(e);n=e.attr("label");if(n){r=u(e)||{};r[m]=n;r[y]=n;s.optgroups.push(r)}o=C("option",e);for(t=0,i=o.length;t<i;t++){p(o[t],n)}};s.maxItems=e.attr("multiple")?null:1;r=e.children();for(t=0,i=r.length;t<i;t++){n=r[t].tagName.toLowerCase();if(n==="optgroup"){c(r[t])}else if(n==="option"){p(r[t])}}};return this.each(function(){if(this.selectize)return;var e;var t=C(this);var i=this.tagName.toLowerCase();var n=t.attr("placeholder")||t.attr("data-placeholder");if(!n&&!f.allowEmptyOption){n=t.children('option[value=""]').text()}var r={placeholder:n,options:[],optgroups:[],items:[]};if(i==="select"){l(t,r)}else{a(t,r)}e=new j(t,C.extend(true,{},s,r,o))})};C.fn.selectize.defaults=j.defaults;C.fn.selectize.support={validity:I};j.define("drag_drop",function(e){if(!C.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(this.settings.mode!=="multi")return;var n=this;n.lock=function(){var t=n.lock;return function(){var e=n.$control.data("sortable");if(e)e.disable();return t.apply(n,arguments)}}();n.unlock=function(){var t=n.unlock;return function(){var e=n.$control.data("sortable");if(e)e.enable();return t.apply(n,arguments)}}();n.setup=function(){var e=n.setup;return function(){e.apply(this,arguments);var i=n.$control.sortable({items:"[data-value]",forcePlaceholderSize:true,disabled:n.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width"));i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var e=n.$activeItems?n.$activeItems.slice():null;var t=[];i.children("[data-value]").each(function(){t.push(C(this).attr("data-value"))});n.setValue(t);n.setActiveItem(e)}})}}()});j.define("dropdown_header",function(t){var i=this;t=C.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'">'+'<div class="'+e.titleRowClass+'">'+'<span class="'+e.labelClass+'">'+e.title+"</span>"+'<a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a>'+"</div>"+"</div>"}},t);i.setup=function(){var e=i.setup;return function(){e.apply(i,arguments);i.$dropdown_header=C(t.html(t));i.$dropdown.prepend(i.$dropdown_header)}}()});j.define("optgroup_columns",function(a){var l=this;a=C.extend({equalizeWidth:true,equalizeHeight:true},a);this.getAdjacentOption=function(e,t){var i=e.closest("[data-group]").find("[data-selectable]");var n=i.index(e)+t;return n>=0&&n<i.length?i.eq(n):C()};this.onKeyDown=function(){var o=l.onKeyDown;return function(e){var t,i,n,r;if(this.isOpen&&(e.keyCode===p||e.keyCode===f)){l.ignoreHover=true;r=this.$activeOption.closest("[data-group]");t=r.find("[data-selectable]").index(this.$activeOption);if(e.keyCode===p){r=r.prev("[data-group]")}else{r=r.next("[data-group]")}n=r.find("[data-selectable]");i=n.eq(Math.min(n.length-1,t));if(i.length){this.setActiveOption(i)}return}return o.apply(this,arguments)}}();var u=function(){var e;var t=u.width;var i=document;if(typeof t==="undefined"){e=i.createElement("div");e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>';e=e.firstChild;i.body.appendChild(e);t=u.width=e.offsetWidth-e.clientWidth;i.body.removeChild(e)}return t};var e=function(){var e,t,i,n,r,o,s;s=C("[data-group]",l.$dropdown_content);t=s.length;if(!t||!l.$dropdown_content.width())return;if(a.equalizeHeight){i=0;for(e=0;e<t;e++){i=Math.max(i,s.eq(e).height())}s.css({height:i})}if(a.equalizeWidth){o=l.$dropdown_content.innerWidth()-u();n=Math.round(o/t);s.css({width:n});if(t>1){r=o-n*(t-1);s.eq(t-1).css({width:r})}}};if(a.equalizeHeight||a.equalizeWidth){t.after(this,"positionDropdown",e);t.after(this,"refreshOptions",e)}});j.define("remove_button",function(e){e=C.extend({label:"&times;",title:"Remove",className:"remove",append:true},e);var t=function(r,o){o.className="remove-single";var s=r;var a='<a href="javascript:void(0)" class="'+o.className+'" tabindex="-1" title="'+D(o.title)+'">'+o.label+"</a>";var l=function(e,t){return e+t};r.setup=function(){var n=s.setup;return function(){if(o.append){var e=C(s.$input.context).attr("id");var t=C("#"+e);var i=s.settings.render.item;s.settings.render.item=function(e){return l(i.apply(r,arguments),a)}}n.apply(r,arguments);r.$control.on("click","."+o.className,function(e){e.preventDefault();if(s.isLocked)return;s.clear()})}}()};var i=function(i,n){var r=i;var o='<a href="javascript:void(0)" class="'+n.className+'" tabindex="-1" title="'+D(n.title)+'">'+n.label+"</a>";var s=function(e,t){var i=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,i)+t+e.substring(i)};i.setup=function(){var e=r.setup;return function(){if(n.append){var t=r.settings.render.item;r.settings.render.item=function(e){return s(t.apply(i,arguments),o)}}e.apply(i,arguments);i.$control.on("click","."+n.className,function(e){e.preventDefault();if(r.isLocked)return;var t=C(e.currentTarget).parent();r.setActiveItem(t);if(r.deleteSelection()){r.setCaret(r.items.length)}})}}()};if(this.settings.mode==="single"){t(this,e);return}else{i(this,e)}});j.define("restore_on_backspace",function(r){var e=this;r.text=r.text||function(e){return e[this.settings.labelField]};this.onKeyDown=function(){var n=e.onKeyDown;return function(e){var t,i;if(e.keyCode===g&&this.$control_input.val()===""&&!this.$activeItems.length){t=this.caretPos-1;if(t>=0&&t<this.items.length){i=this.options[this.items[t]];if(this.deleteSelection(e)){this.setTextboxValue(r.text.apply(this,[i]));this.refreshOptions(true)}e.preventDefault();return}}return n.apply(this,arguments)}}()});return j});