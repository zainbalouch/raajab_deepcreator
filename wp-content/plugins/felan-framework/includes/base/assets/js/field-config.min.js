var GLFFieldsConfig=GLFFieldsConfig||{};(function(c){"use strict";GLFFieldsConfig.fieldInstance=[];GLFFieldsConfig.required={applyField:[],init:function(){this.processApplyField();this.onChange()},processApplyField:function(){c(".glf-field[data-required]").each(function(){var e=c(this),i=e.data("required"),l=e.attr("id"),n,t,a,f,r,d,o;if(c.isArray(i[0])){for(n=0;n<i.length;n++){a=i[n];if(c.isArray(a[0])){for(t=0;t<a.length;t++){f=a[t];r=f[0];d=f[1];o=f[2];if(r.indexOf("[")!=-1){r=r.replace(/\[.*/i,"")}if(typeof GLFFieldsConfig.required.applyField[r]==="undefined"){GLFFieldsConfig.required.applyField[r]=[]}if(GLFFieldsConfig.required.applyField[r].indexOf(l)===-1){GLFFieldsConfig.required.applyField[r].push(l)}if(d[0]==="&"){if(typeof GLFFieldsConfig.required.applyField[o]==="undefined"){GLFFieldsConfig.required.applyField[o]=[]}if(GLFFieldsConfig.required.applyField[o].indexOf(l)===-1){GLFFieldsConfig.required.applyField[o].push(l)}}}}else{r=a[0];d=a[1];o=a[2];if(r.indexOf("[")!=-1){r=r.replace(/\[.*/i,"")}if(typeof GLFFieldsConfig.required.applyField[r]==="undefined"){GLFFieldsConfig.required.applyField[r]=[]}if(GLFFieldsConfig.required.applyField[r].indexOf(l)===-1){GLFFieldsConfig.required.applyField[r].push(l)}if(d[0]==="&"){if(typeof GLFFieldsConfig.required.applyField[o]==="undefined"){GLFFieldsConfig.required.applyField[o]=[]}if(GLFFieldsConfig.required.applyField[o].indexOf(l)===-1){GLFFieldsConfig.required.applyField[o].push(l)}}}}}else{r=i[0];d=i[1];o=i[2];if(r.indexOf("[")!=-1){r=r.replace(/\[.*/i,"")}if(typeof GLFFieldsConfig.required.applyField[r]==="undefined"){GLFFieldsConfig.required.applyField[r]=[]}if(GLFFieldsConfig.required.applyField[r].indexOf(l)===-1){GLFFieldsConfig.required.applyField[r].push(l)}if(d[0]==="&"){if(typeof GLFFieldsConfig.required.applyField[o]==="undefined"){GLFFieldsConfig.required.applyField[o]=[]}if(GLFFieldsConfig.required.applyField[o].indexOf(l)===-1){GLFFieldsConfig.required.applyField[o].push(l)}}}})},onChange:function(){c(".glf-field").on("glf_check_required",GLFFieldsConfig.required.onChangeEvent)},onChangeEvent:function(e){if(this!=e.target){return}var i=c(this),l=i.attr("id");if(typeof i.data("field-value")=="undefined"){return}if(typeof GLFFieldsConfig.required.applyField[l]==="undefined"){return}var n,t=i.closest(".glf-clone-field-panel");if(t.length){for(n=0;n<GLFFieldsConfig.required.applyField[l].length;n++){GLFFieldsConfig.required.toggleField(c("#"+GLFFieldsConfig.required.applyField[l][n],t),t)}}else{for(n=0;n<GLFFieldsConfig.required.applyField[l].length;n++){GLFFieldsConfig.required.toggleField(c("#"+GLFFieldsConfig.required.applyField[l][n]),t)}}},toggleField:function(e,i){var l=e.data("required"),n=true;if(!c.isArray(l[0])){n=GLFFieldsConfig.required.processField(l,i)}else{n=GLFFieldsConfig.required.andCondition(l,i)}if(n){e.slideDown()}else{e.slideUp()}},andCondition:function(e,i){var l,n;for(n=0;n<e.length;n++){l=e[n];if(!c.isArray(l[0])){if(!GLFFieldsConfig.required.processField(l,i)){return false}}else{if(!GLFFieldsConfig.required.orCondition(l,i)){return false}}}return true},orCondition:function(e,i){var l,n;for(n=0;n<e.length;n++){l=e[n];if(GLFFieldsConfig.required.processField(l,i)){return true}}return false},processField:function(e,i){var l=e[0],n=e[1],t=e[2],a,f="";if(l.indexOf("[")!=-1){var r=l.replace(/\[.*/i,"");f=l.substring(r.length);f=f.substr(1,f.length-2);l=r}if(i.length){a=c("#"+l,i).data("field-value")}else{a=c("#"+l).data("field-value")}if(f!==""&&typeof a[f]!=="undefined"){a=a[f]}if(n.substr(0,1)==="&"){if(i.length){t=c("#"+t,i).data("field-value")}else{t=c("#"+t).data("field-value")}}switch(n){case"=":case"&=":return t==a;case"!=":case"&!=":return t!=a;case"in":case"&in":return t==a||c.isArray(t)&&t.indexOf(a)!=-1;case"not in":case"&not in":return!c.isArray(t)&&t!=a||t.indexOf(a)==-1;case"contain":case"&contain":return t==a||c.isArray(a)&&a.indexOf(t)!=-1||typeof a==="object"&&t in a;case"not contain":case"&not contain":return!c.isArray(a)&&a!=t||a.indexOf(t)==-1}return false},checkRequired:function(e,i){e.data("field-value",i);e.trigger("glf_check_required");e.trigger("glf_check_preset");e.trigger("glf_field_change")}};GLFFieldsConfig.preset={init:function(){this.onChange()},onChange:function(){c(".glf-fields-wrapper").on("glf_check_preset",".glf-field",function(e){if(this!=e.target){return}var i=c(this),l=i.closest(".glf-clone-field-panel");if(l.length===0){l=c(".glf-fields-wrapper")}if(typeof i.data("field-value")=="undefined"){return}var n=i.data("preset");if(typeof n=="undefined"){return}var t=i.data("field-value"),a,f,r,d,o;for(a=0;a<n.length;a++){r=n[a]["op"];d=n[a]["value"];o=n[a]["fields"];if(r==="="&&d==t||r==="!="&&d!=t){for(f=0;f<o.length;f++){var s=l.find("#"+o[f][0]);s.find("[data-field-control]").val(o[f][1]);s.find("[data-field-control]").trigger("glf_preset_change",o[f][1]);s.find("[data-field-control]").trigger("change")}break}}})}};GLFFieldsConfig.cloneField={cloneTemplate:[],init:function(){this.makeCloneTemplate();this.addButton();this.removeButton();this.sortableField()},makeCloneTemplate:function(e){var i=0;c(".glf-field-content-inner-clone").each(function(){var e=c("> .glf-clone-field:last",this);if(e.length>0){GLFFieldsConfig.cloneField.cloneTemplate[i]=e[0].outerHTML;c(this).attr("data-clone-template",i);i++}});var l=c(".glf-meta-config-wrapper");l=l.length?l:c("body");l.trigger("glf_make_template_done")},makeCloneTemplateElement:function(e){var i=GLFFieldsConfig.cloneField.cloneTemplate.length+1;e.each(function(){var e=c("> .glf-clone-field:last",this);if(e.length>0){GLFFieldsConfig.cloneField.cloneTemplate[i]=e[0].outerHTML;c(this).attr("data-clone-template",i);i++}});e.trigger("glf_make_template_item_done")},reIndexFieldName:function(e,i){var f=0,r=false,l=false;var n=e.closest(".glf-field");if(n.hasClass("glf-panel")){l=true}else{if(n.closest(".glf-panel").length){r=true}}if(!l){c(".glf-clone-field",e).each(function(){c(':input[name$="]"]',this).each(function(){if(r){var e=c(this),i=e.attr("name"),l=i.replace(/\w+\[\d+\]\[\w+\]/i,""),n=i.substring(0,i.length-l.length),t=l.replace(/^\[\d+\]/i,"");e.attr("name",n+"["+f+"]"+t);var a=c(this).closest(".glf-clone-field").parent().closest(".glf-clone-field").data("panel-index");n=e.attr("name").replace(/\[.*/i,"");t=e.attr("name").replace(/[^\]]*\]/i,"");e.attr("name",n+"["+a+"]"+t)}else{var e=c(this);var n=e.attr("name").replace(/\[.*/i,"");var t=e.attr("name").replace(/[^\]]*\]/i,"");e.attr("name",n+"["+f+"]"+t)}});f++})}else{f=0;c("> .glf-clone-field",e).each(function(){c(this).data("panel-index",f);c(':input[name$="]"]',this).each(function(){var e=c(this);var i=e.attr("name").replace(/\[.*/i,"");var l=e.attr("name").replace(/[^\]]*\]/i,"");e.attr("name",i+"["+f+"]"+l)});f++})}if(i){c('input[type="hidden"]',e).val(f)}},removeButton:function(e){if(typeof e==="undefined"){e=c(".glf-fields-wrapper")}e.find(".glf-clone-button-remove").on("click",function(){var e=c(this).parent();var i=e.parent();e.remove();GLFFieldsConfig.cloneField.reIndexFieldName(i,c(this).hasClass("glf-is-repeater"))})},addButton:function(){c(".glf-clone-button-add").on("click",function(){var e=c(this).parent().find("> .glf-field-content-inner");if(typeof e.attr("data-clone-template")=="undefined"){return}var i=parseInt(e.attr("data-clone-template"),10);var l=c("> .glf-clone-field:last",e);var n=c(GLFFieldsConfig.cloneField.cloneTemplate[i]);if(l.length==0){e.prepend(n)}else{l.after(n)}GLFFieldsConfig.cloneField.removeButton(n);GLFFieldsConfig.cloneField.emptyElementValue(n);GLFFieldsConfig.cloneField.reIndexFieldName(e,c(this).hasClass("glf-is-repeater"));n.trigger("glf_add_clone_field")})},emptyElementValue:function(e){c("[data-field-control]",e).each(function(){var e=c(this).closest(".glf-field");e.data("field-value","");if(e.hasClass("glf-field-text")){c(this).val("")}else if(e.hasClass("glf-field-select")){c(this).prop("selectedIndex",0)}})},sortableField:function(){c(".glf-field-content-inner-clone").sortable({placeholder:"glf-field-clone-sortable-placeholder",handle:".glf-sortable-button",update:function(e,i){var l=c(e.target);GLFFieldsConfig.cloneField.reIndexFieldName(l,false)}})}};GLFFieldsConfig.group={init:function(){this.toggle()},toggle:function(){c(".glf-group-toggle").closest("h4").on("click",function(){var e=c(this),i=e.find(".glf-group-toggle"),l=e.next(".glf-group-inner");i.toggleClass("dashicons-arrow-up").toggleClass("dashicons-arrow-down");l.slideToggle()})}};GLFFieldsConfig.fields={getValue:function(e){var t="[data-field-control]",a="",i=c(t+":first",e),f=i.attr("type"),l=i.attr("name"),r=e.data("field-map"),d=l.match(/\[\]$/i);if(r!=""){r=r.split(",")}if(typeof f==="undefined"){f=""}f=f.toLowerCase();var o=f=="radio"||f=="checkbox"?true:false;if(c(".glf-clone-field",e).length){a=[];c(".glf-clone-field",e).each(function(){if(d){var e=[];c(t,this).each(function(){if(o){if(c(this).prop("checked")){e.push(c(this).val())}else{e.push("")}}else{e.push(c(this).val())}});a.push(e)}else{if(r.length){e=[];for(var i=0;i<r.length;i++){var l=c(t+'[name$="['+r[i]+']"]',this);f=l.attr("type");if(typeof f==="undefined"){f=""}f=f.toLowerCase();o=f=="radio"||f=="checkbox"?true:false;if(o){if(l.prop("checked")){e[r[i]]=l.val()}else{if(!l.data("uncheck-novalue")){a[r[i]]=""}e[r[i]]=""}}else{e[r[i]]=l.val()}}a.push(e)}else{if(o){if(f==="radio"){var n=true;c(t,this).each(function(){if(c(this).prop("checked")){a.push(c(this).val());n=false}});if(n){a.push("")}}else{if(c(t,this).prop("checked")){a.push(c(t,this).val())}else{a.push("")}}}else{a.push(c(t,this).val())}}}})}else{if(d){a=[];if(o){c(t,e).each(function(){if(c(this).prop("checked")){a.push(c(this).val())}else{a.push("")}})}else{c(t,e).each(function(){a.push(c(this).val())})}}else{if(r.length){a=[];for(var n=0;n<r.length;n++){var s=c(t+'[name$="['+r[n]+']"]',e);f=s.attr("type");if(typeof f==="undefined"){f=""}f=f.toLowerCase();o=f=="radio"||f=="checkbox"?true:false;if(o){if(s.prop("checked")){a[r[n]]=s.val()}else{if(!s.data("uncheck-novalue")){a[r[n]]=""}}}else{a[r[n]]=s.val()}}}else{if(o){if(f==="radio"){c(t,e).each(function(){if(c(this).prop("checked")){a=c(this).val()}})}else{if(c(t,e).prop("checked")){a=c(t,e).val()}}}else{a=c(t,e).val()}}}}return a}};GLFFieldsConfig.tabs={init:function(){this.toggle();setTimeout(function(){GLFFieldsConfig.tabs.changeWidthContent()},100)},toggle:function(){c(".glf-tab a").on("click",function(e){var i=c(".glf-fields-wrapper > div.glf-section-container:visible").attr("id");e.preventDefault();if(typeof e.currentTarget.hash!="undefined"){c("#"+i).hide();c(e.currentTarget.hash).fadeIn()}c(".glf-tab li").removeClass("active");c(this).parent().addClass("active");c(this).trigger("glf-tab-clicked")})},changeWidthContent:function(){var e=c(".glf-tab");if(e.length>0){var i=c(".glf-meta-box-wrap"),l=c(".glf-fields"),n=e.outerWidth(),t=i.width();l.css({float:"left",width:t-n+"px",overflow:"visible"})}}};GLFFieldsConfig.onReady={init:function(){GLFFieldsConfig.cloneField.init();GLFFieldsConfig.group.init();GLFFieldsConfig.required.init();GLFFieldsConfig.preset.init();GLFFieldsConfig.tabs.init();c(".glf-field").trigger("glf_check_required")}};GLFFieldsConfig.onResize={init:function(){GLFFieldsConfig.tabs.changeWidthContent()}};c(document).ready(GLFFieldsConfig.onReady.init);c(window).resize(GLFFieldsConfig.onResize.init)})(jQuery);