(function (m) {
  "use strict";
  m.fn.FelanGridQuery = function () {
    var o, s;
    var d = false;
    var r;
    var u = false;
    function i() {
      if (!o.children(".felan-grid-filter").data("filter-counter")) {
        return;
      }
      o.find(".btn-filter").each(function () {
        var i = m(this).data("filter-count");
        if (m(this).children(".filter-counter").length > 0) {
          m(this).children(".filter-counter").text(i);
        } else {
          m(this).append('<span class="filter-counter">' + i + "</span>");
        }
      });
    }
    function e() {
      o.children(".felan-grid-filter").on("click", ".btn-filter", function (i) {
        if (m(this).hasClass("current")) {
          i.preventDefault();
          return;
        }
        if ("1" != o.data("query-main")) {
          i.preventDefault();
        } else {
          return;
        }
        var e = m(this);
        var a = e.attr("data-filter");
        if ("*" === a) {
          h("extra_tax_query", "");
        } else {
          h("extra_tax_query", a);
        }
        o.trigger("FelanBeginQuery");
        e.siblings().removeClass("current");
        e.addClass("current");
      });
    }
    function a() {
      if (m("body").hasClass("elementor-editor-active")) {
        return;
      }
      if (o.data("pagination") === "load-more") {
        o.children(".felan-grid-pagination")
          .find(".felan-load-more-button")
          .on("click", function (i) {
            i.preventDefault();
            if (!d) {
              m(this).hide();
              var e = g("paged");
              e++;
              h("paged", e);
              u = true;
              f();
            }
          });
      } else if (o.data("pagination") === "load-more-alt") {
        var i = m(o.data("pagination-custom-button-id"));
        i.on("click", function (i) {
          i.preventDefault();
          if (!d) {
            m(this).hide();
            var e = g("paged");
            e++;
            h("paged", e);
            f();
          }
        });
      } else if (o.data("pagination") === "infinite") {
        var e = setInterval(function () {
          if (s.hasClass("loaded")) {
            t();
            clearInterval(e);
          }
        }, 200);
      } else if (o.data("pagination") === "navigation") {
        var n = o.find(".prev-link"),
          r = o.find(".next-link");
        o.on("click", ".nav-link", function (i) {
          i.preventDefault();
          if (d) {
            return;
          }
          if (m(this).hasClass("disabled")) {
            return;
          }
          var e = m(this).data("action");
          var a = g("paged");
          var t = v("max_num_pages");
          if (e === "prev") {
            if (a > 1) {
              a--;
            }
          } else {
            if (a < t) {
              a++;
            }
          }
          if (a > 1) {
            n.removeClass("disabled");
          } else {
            n.addClass("disabled");
          }
          if (t > a) {
            r.removeClass("disabled");
          } else {
            r.addClass("disabled");
          }
          h("paged", a);
          f(true);
        });
      }
    }
    function t() {
      var i = m(window).height();
      var e = (90 / 100) * i;
      e = parseInt(e);
      var a = o.offset().top;
      var t = o.outerHeight(true);
      var n = a + t;
      var r = n - e;
      var s = 0;
      m(window).scroll(function () {
        var i = m(this).scrollTop();
        if (i > s && i >= r) {
          if (!d) {
            var e = g("paged");
            var a = v("max_num_pages");
            if (e < a) {
              e++;
              h("paged", e);
              u = true;
              f();
            }
          }
        }
        s = i;
      });
      m(window).on("resize", function () {
        setTimeout(function () {
          i = m(window).height();
          e = (90 / 100) * i;
          e = parseInt(e);
          a = o.offset().top;
          t = o.outerHeight(true);
          n = a + t;
          r = n - e;
        }, 100);
      });
    }
    function f(t) {
      d = true;
      var n;
      if (u === true) {
        n = o.find(".felan-infinite-loader");
      } else {
        n = s.children(".felan-grid-loader");
      }
      n.addClass("show");
      setTimeout(function () {
        var i = jQuery.parseJSON(r.val());
        var e = m.param(i);
        m.ajax({
          url: $felan.ajaxurl,
          type: "POST",
          data: e,
          dataType: "json",
          success: function (i) {
            if (i.max_num_pages) {
              p("max_num_pages", i.max_num_pages);
            }
            if (i.found_posts) {
              p("found_posts", i.found_posts);
            }
            if (i.count) {
              p("count", i.count);
            }
            var e = i.template;
            var a = m(e);
            if (t === true) {
              s.children(".grid-item").remove();
            }
            o.trigger("FelanQueryEnd", [o, a]);
            c();
            l();
            n.removeClass("show");
            d = false;
            u = false;
          },
        });
      }, 500);
    }
    function l() {
      if (o.data("pagination") === "navigation") {
        return;
      }
      var i = v("found_posts");
      var e = g("paged");
      var a = g("posts_per_page");
      if (i <= e * a) {
        if (o.data("pagination") === "load-more-alt") {
          var t = m(o.data("pagination-custom-button-id"));
          t.hide();
        } else {
          o.children(".felan-grid-pagination").hide();
        }
        o.children(".felan-grid-messages").show(1);
        setTimeout(function () {
          o.children(".felan-grid-messages").remove();
        }, 5e3);
      } else {
        if (o.data("pagination") === "load-more-alt") {
          var t = m(o.data("pagination-custom-button-id"));
          t.show();
        } else {
          o.children(".felan-grid-pagination").show();
          o.children(".felan-grid-pagination")
            .find(".felan-load-more-button")
            .show();
        }
      }
    }
    function c() {
      var i = o.find(".result-count").first();
      if (i.length > 0) {
        var e = v("found_posts");
        i.find(".count").text(e);
      }
    }
    function v(i) {
      var e = jQuery.parseJSON(r.val());
      return e[i];
    }
    function p(i, e) {
      var a = jQuery.parseJSON(r.val());
      a[i] = e;
      r.val(JSON.stringify(a));
    }
    function g(i) {
      var e = jQuery.parseJSON(r.val());
      return e.query_vars[i];
    }
    function h(i, e) {
      var a = jQuery.parseJSON(r.val());
      a.query_vars[i] = e;
      r.val(JSON.stringify(a));
    }
    return this.each(function () {
      o = m(this);
      s = o.find(".felan-grid");
      r = o.find(".felan-query-input").first();
      i();
      e();
      a();
      o.on("FelanBeginQuery", function () {
        h("paged", 1);
        f(true);
      });
    });
  };
})(jQuery);
